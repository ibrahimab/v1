<?php

if($_GET["ok"]==1) {
	echo "<p>Bedankt voor je inschrijving voor de nieuwsbrief van ".wt_he($vars["websitenaam"])."!</p>";
	echo "<p>Binnen enkele minuten ontvang je een e-mail ter bevestiging.</p>";
} else {
	if($_POST["mail"] and $_POST["mail"]<>"e-mailadres") {
	#	$extra="&mmprevalue_mail=".urlencode($_POST["mail"])."&mmhideintro=1";
		echo "<div id=\"nieuwsbrief_vulin\">Vul hieronder je voor- en achternaam in om de inschrijving af te ronden.</div>";
	} else {
		echo "<div style=\"width:612px;\">";
		if($vars["seizoentype"]==1) {
			echo "<p>Schrijf jezelf hier in voor de nieuwsbrief van ".htmlentities($vars["websitenaam"])." en ontvang regelmatig aanbiedingen, nieuws en reistips.</p>";
		} else {
			echo "<p>Schrijf jezelf hier in voor de nieuwsbrief van ".htmlentities($vars["websitenaam"])." en ontvang regelmatig aanbiedingen, nieuws en reistips.</p>";
		}
		echo "</div>";
	}

	echo "<div style=\"width:600px;padding:5px;border:1px solid ".$bordercolor.";margin-bottom:20px;\">";

	if($vars["website"]=="C") {
		# Chalet.nl
		$blinker_fields["email"]="field1038";
		$blinker_fields["voornaam"]="field1040";
		$blinker_fields["tussenvoegsel"]="field1041";
		$blinker_fields["achternaam"]="field1036";
		$blinker_fields["per_wanneer"]="field10934";
		$blinker_fields["formEncId"]="MwJLgCnDPkS9LWs";
	} elseif($vars["website"]=="B") {
		# Chalet.be
		$blinker_fields["email"]="field10946";
		$blinker_fields["voornaam"]="field10947";
		$blinker_fields["tussenvoegsel"]="field10948";
		$blinker_fields["achternaam"]="field10949";
		$blinker_fields["per_wanneer"]="field10950";
		$blinker_fields["formEncId"]="mfR7fLLhFtS3ppW";
	} elseif($vars["website"]=="I") {
		# Italissima.nl
		$blinker_fields["email"]="field10751";
		$blinker_fields["voornaam"]="field10761";
		$blinker_fields["tussenvoegsel"]="field10771";
		$blinker_fields["achternaam"]="field10781";
		$blinker_fields["formEncId"]="J4XyB4nwd7v3yi8";
	} elseif($vars["website"]=="K") {
		# Italissima.be
		$blinker_fields["email"]="field10952";
		$blinker_fields["voornaam"]="field10953";
		$blinker_fields["tussenvoegsel"]="field10954";
		$blinker_fields["achternaam"]="field10955";
		$blinker_fields["formEncId"]="HN6Txi7YfZvamjD";
	}

	?>
		<script type='text/javascript' src='https://m16.mailplus.nl/genericservice/code/servlet/js-lib/calendar/calendar.js'></script>
		<script type='text/javascript' src='https://m16.mailplus.nl/genericservice/code/servlet/js-lib/calendar/lang/calendar-nl.js'></script>
		<script type='text/javascript' src='https://m16.mailplus.nl/genericservice/code/servlet/js-lib/calendar/calendar-setup.js'></script>
		<link rel='stylesheet' type='text/css' media='all' href='https://m16.mailplus.nl/genericservice/code/servlet/js-lib/calendar/skins/aqua/theme.css' title='Aqua' />
		<link rel='stylesheet' type='text/css' media='all' href='https://m16.mailplus.nl/genericservice/code/servlet/js-lib/calendar/calendar-win2k-cold-1.css' title='win2k-cold-1' />
		<script type='text/javascript'>function setRedBorder(id){ var elem = document.getElementById(id); if (elem && elem.style) { elem.style.border = '1px solid red';} } </script>
		<script type='text/javascript'>function setHiddenBorder(id){ var elem = document.getElementById(id); if (elem && elem.style) { elem.style.border = '';} } </script>
		<form method="post" action="https://m16.mailplus.nl/genericservice/code/servlet/Redirect" enctype="application/x-www-form-urlencoded" name="form1004" id="form1004" onsubmit="return checkFormform1004(this);">
<script type="text/javascript">
function checkFormform1004(myForm) {
try {
	var errorMessage = 'Het formulier kon niet worden verzonden om de volgende reden(en):\n\n';
	var errorFound = false;

	 setHiddenBorder('<?php echo $blinker_fields["email"]; ?>TD');
	if (myForm.<?php echo $blinker_fields["email"]; ?> != null) {
		if (myForm.<?php echo $blinker_fields["email"]; ?>.value == '') {
			errorMessage = errorMessage + '- Geen waarde ingevuld voor E-mailadres.\n';
			errorFound = true;
			setRedBorder('<?php echo $blinker_fields["email"]; ?>TD');
		} else {
			emailAddress = myForm.<?php echo $blinker_fields["email"]; ?>.value;
			if (emailAddress.search(/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&''*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i) == -1) {
				errorMessage = errorMessage + '- Geen geldig e-mail adres ingevuld voor E-mailadres.\n';
				setRedBorder('<?php echo $blinker_fields["email"]; ?>TD');
				errorFound = true;
			}
		}
	}
	if (myForm.<?php echo $blinker_fields["voornaam"]; ?> != null) {
		if (myForm.<?php echo $blinker_fields["voornaam"]; ?>.value == '') {
			errorMessage = errorMessage + '- Geen waarde ingevuld voor Voornaam.\n';
				setRedBorder('<?php echo $blinker_fields["voornaam"]; ?>TD');
			errorFound = true;
		}
		 else { setHiddenBorder('<?php echo $blinker_fields["voornaam"]; ?>TD'); }
	}
	if (myForm.<?php echo $blinker_fields["achternaam"]; ?> != null) {
		if (myForm.<?php echo $blinker_fields["achternaam"]; ?>.value == '') {
			errorMessage = errorMessage + '- Geen waarde ingevuld voor Achternaam.\n';
				setRedBorder('<?php echo $blinker_fields["achternaam"]; ?>TD');
			errorFound = true;
		}
		 else { setHiddenBorder('<?php echo $blinker_fields["achternaam"]; ?>TD'); }
	}

	if (errorFound) {
		alert(errorMessage);
		return false;
	}

	return true;
} catch (err) {
	return false;
}
}
</script>
		<table class="mpFormTable" border="0" cellpadding="5" cellspacing="0">
		<tr class="mpFormRow">
			<td class="mpFormLabel">E-mailadres *</td>
			<td class="mpFormField" id="<?php echo $blinker_fields["email"]; ?>TD"><input type="text" name="<?php echo $blinker_fields["email"]; ?>" value="<?php if($_POST["mail"] and $_POST["mail"]<>"e-mailadres") echo htmlentities($_POST["mail"]); ?>">
		</td>
		</tr>
		<tr class="mpFormRow">
			<td class="mpFormLabel">Voornaam *</td>
			<td class="mpFormField" id="<?php echo $blinker_fields["voornaam"]; ?>TD"><input type="text" name="<?php echo $blinker_fields["voornaam"]; ?>" value="">
		</td>
		</tr>
		<tr class="mpFormRow">
			<td class="mpFormLabel">Tussenvoegsel</td>
			<td class="mpFormField" id="<?php echo $blinker_fields["tussenvoegsel"]; ?>TD"><input type="text" name="<?php echo $blinker_fields["tussenvoegsel"]; ?>" value="">
		</td>
		</tr>
		<tr class="mpFormRow">
			<td class="mpFormLabel">Achternaam *</td>
			<td class="mpFormField" id="<?php echo $blinker_fields["achternaam"]; ?>TD"><input type="text" name="<?php echo $blinker_fields["achternaam"]; ?>" value="">
		</td>
		</tr>
		<?php if($blinker_fields["per_wanneer"]) { ?>
		<tr class="mpFormRow">
			<td class="mpFormLabel">&nbsp;</td>
			<td><table cellspacing="0" cellpadding="4" border="0"><tr><td colspan="2">Ik wil graag de Chalet.nl-nieuwsbrief ontvangen:</td></tr>
				<tr><td valign="top"><input type="radio" name="<?php echo $blinker_fields["per_wanneer"]; ?>" value="" id="per_wanneer1" checked></td><td><label for="per_wanneer1">per direct</label></td></tr>
				<tr><td valign="top"><input type="radio" name="<?php echo $blinker_fields["per_wanneer"]; ?>" value="ja" id="per_wanneer2"></td><td><label for="per_wanneer2">tegen het einde van dit winterseizoen, met nieuws over het volgende winterseizoen</label></td></tr></table>
		</td>
		</tr>
		<?php } ?>

		<tr><td class="submitCellSpacer">&nbsp;</td><td class="submitCell"><input type="submit" value="Aanmelden"></td></tr></table>
		<input type="hidden" name="serviceInstanceId" id="serviceInstanceId" value="31302289">
		<input type="hidden" name="okLink" id="okLink" value="<?php echo htmlentities($vars["basehref"]."nieuwsbrief.php?ok=1"); ?>">
		<input type="hidden" name="redir" id="redir" value="formAdmin">
		<input type="hidden" name="formEncId" id="formEncId" value="<?php echo $blinker_fields["formEncId"]; ?>">

		</form>
		<?php

	echo "</div>";

	# eerder verstuurde nieuwsbrieven tonen (te bewerken via http://www.chalet.nl/cms_overzichten_overig.php?t=10)
	$db->query("SELECT ".($vars["seizoentype"]==1 ? "winternieuwsbrieven" : "zomernieuwsbrieven")." AS nieuwsbrief FROM diverse_instellingen WHERE diverse_instellingen_id=1;");
	if($db->next_record()) {
		$nieuwsbrieven_array=preg_split("/\n/",$db->f("nieuwsbrief"));
		while(list($key,$value)=@each($nieuwsbrieven_array)) {
			if(preg_match("/^([0-9]+) (.*)$/",$value,$regs)) {
				$nieuwsbrieven[$regs[1]]=$regs[2];
			}
		}
		if(is_array($nieuwsbrieven)) {
			echo "<h3 style=\"margin-bottom:8px;\">Onlangs verstuurde nieuwsbrieven:</h3>";
			echo "<ul>";
			while(list($key,$value)=each($nieuwsbrieven)) {
				echo "<li><a href=\"http://chaletnl.m16.mailplus.nl/archief/mailing-".wt_he($key).".html\" target=\"_blank\">".wt_he($value)."</a></li>";
			}
			echo "</ul>";
		}
	}
}

?>