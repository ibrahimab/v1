<div id="transactieResult" style="display:none;"></div>
<div id="firstScreen">
<table width="100%" align="center">
	<tr>
		<td colspan="2"><b>Boekingsgegevens:</b></td>
	</tr>
	<tr>
		<td>Reserveringsnummer</td>
		<td><?php echo $boekingObject["reserveringsnummer"]; ?></td>
	</tr>
	<tr>
		<td>Plaats</td>
		<td><?php echo $boekingObject["plaats"]; ?></td>
	</tr>
	<tr>
		<td>Accommodatie</td>
		<td><?php echo $boekingObject["Accommodatie"]; ?></td>
	</tr>
	<tr>
		<td>Deelnemers</td>
		<td><?php echo $boekingObject["Deelnemers"]; ?></td>
	</tr>
	<tr>
		<td>Verblijfsperiode</td>
		<td><?php echo $boekingObject["Verblijfsperiode"]; ?></td>
	</tr>
	<tr>
		<td colspan="2"><b>Openstaand bedrag:</b></td>
	</tr>
	<tr>
		<td><?php echo $boekingObject["product"][0]; ?></td>
		<td>&euro; <?php echo number_format($boekingObject["product"]["prijs"][0], 2, ',', ' '); ?></td>
	</tr>
	<tr>
		<td><?php echo $boekingObject["product"][1]; ?></td>
		<td>&euro; <?php echo number_format($boekingObject["product"]["prijs"][1], 2, ',', ' '); ?></td>
	</tr>
	<tr>
		<td height="5"></td>
		<td></td>
	</tr>
	<tr>
		<td><b>Totaal:</b></td>
		<td><b>&euro; <?php echo number_format($boekingObject["Totaal boeking bedrag"], 2, ',', ' '); ?></b></td>
	</tr>
	<tr>
		<td height="10">
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<hr/>
		</td>
	</tr>
	<tr>
		<td colspan="2" style="font-size:11px;"><b>Je dient &euro; <?php echo number_format($boekingObject["Termijn"], 2, ',', ' '); ?> binnen 10 dagen te voldoen. Het resterende bedrag dien je uiterlijk 6 weken voor vertrek te betalen.<BR/><BR/></b></td>
	</tr>
	<tr>
		<td>
			<i>Welk gedeelte wil je betalen</i>
		</td>
	</tr>
	<tr>
		<td>
			<input type="radio" name="betalingsoptie" id="deels" value="deel_betaling_doen" />Een deelbetaling doen
			<br/>
 			<input type="radio" name="betalingsoptie" id="volledig" value="Totaal_openstaand_bedrag_betalen" />Het totale bedrag betalen
		</td>
	</tr>
	<tr>
		<td></td>
		<td><input type="button" id="verder" value="Doorgaan"/></td>
	</tr>
	
</table>
</div>
<div id="secondScreen" style="display:none;">
<table width="70%" align="center">
	<tr>
		<td>Nu te voldoen totaal bedrag:</td>
		<td>
			<script> prijs=parseInt(sessionStorage.bedrag);document.write("&euro; "+ prijs.toFixed(2));</script>
		</td>
	</tr>
	<tr>
		<td>Maak een keuze voor de betaling</td>
		<td>
			<select id="bankenLijst">
			</select>
		</td>
	</tr>
	<tr>
		<td></td>
		<td><input type="button" id="afrekenen" value="Betalen"/></td>
	</tr>
</table>
</div>
<?php
if(isset($_GET["success"]) or isset($_GET["canceled"]) or isset($_GET["canceled"])){
?>
<script>
	$.getJSON("/chalet/rpc_json.php", {
		"t": 8,
		"action": "getstatus",
		"trxid":"<?php echo $_GET["trxid"];?>",
	}, function(data) {
		if(data.ok) {
			$("#firstScreen").html(" ");
			if(data.transaction.status=="Success"){
				bericht = "Je transactie is succesvol uitgevoerd. <BR>";
				betaald=data.transaction.amount/100;
				resterend = <?php echo $boekingObject["Totaal boeking bedrag"]?>-betaald;
				resterend=parseInt(resterend);
				bericht +="Het resterende bedrag is: <b>&euro; "+resterend.toFixed(2)+"</b>.<BR>";
				bericht +=" Het bewijs van betaling wordt z.s.m. naar je verzonden";
				$("#transactieResult").html(bericht);
			}
			else{
				$("#transactieResult").html("De transactie is niet gelukt. Probeer het later nogmaals. De status van je transactie is: "+data.transaction.status+"\n");
			}
			$("#transactieResult").slideToggle();
		}		
	});
</script>
<?php } ?>
<script>
$("#afrekenen").click(function () {
	var bedrag;
	bedrag=sessionStorage.bedrag*100;
	var e = document.getElementById("bankenLijst"); 
	var strUser = e.options[e.selectedIndex].value;
	var kenmerk="<?php echo $boekingObject['reserveringsnummer'];?>";
	if(strUser =="Selecteer een bank"){
		window.alert("Selecteer eerst een bank");
	}
	else{
		$.getJSON("/chalet/rpc_json.php", {
			"t": 8,
			"action": "doTransaction",
			"bankID":strUser,
			"bedrag":bedrag,
			"kenmerk":kenmerk,
		}, function(data) {
			if(data.ok) {
				window.location=decodeURIComponent(data.transaction.issuerurl);	
			}		
		});
	}
});
$("#verder").click(function () {
	var opties;
	var strUser = $("input[name='betalingsoptie']:checked").val();
	if(strUser == null){
		window.alert("Selecteer welk gedeelte je wilt betalen");
	}
	else{
		$.getJSON("/chalet/rpc_json.php", {
			"t": 8,
			"action": "getBanks",
		}, function(data) {
			if(data.ok) {
				typ ="<option value='Selecteer een bank'>Selecteer een bank</option>";
				for(i=0;i<data.banken.length;i++){
					opties +="<option value="+data.banken[i].id+">"+data.banken[i].naam+"</option>";
				}
				 $("#bankenLijst").html(opties);
			}
			if(strUser=="deel_betaling_doen"){
				sessionStorage.bedrag = <?php echo $boekingObject["Termijn"];?>
			}
			else if(strUser=="Totaal_openstaand_bedrag_betalen"){
				sessionStorage.bedrag = <?php echo $boekingObject["Totaal boeking bedrag"];?>
			}		
		});
		$("#firstScreen").slideToggle();
		$("#secondScreen").slideToggle();
	}
});
</script>