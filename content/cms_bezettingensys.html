<?php echo"<script type=\"text/javascript\" src=\"".$vars["basehref"]."scripts/popupcalendar.js\"></script>";?>
<div><a id="groepAanMaken" href="#">Groep aan maken</a> | <a id="groepenBekijken" href="#">Groepen bekijken</a> |<a id="leverancierkoppelen" href="#"> Leverancier aan groep koppelen</a></div>
<h2>Groepen aanmaken</h2>
<div style="display:inline" id="subGroepAanMaken"><a href="#" id="peralleTypes">Per alle types</a> | <a href="#" id="peralleLevTypes">Per alle leverancierstypes</a> </div>
<?php
echo "<div style=\"display:inline\" id=\"subAlleTypes\">";
echo "<table><tr><td>Types</td><td>";
	$db->query("SELECT a.naam AS accommodatie, a.accommodatie_id, t.type_id, t.naam AS type, t.code, t.optimaalaantalpersonen, t.maxaantalpersonen, p.naam AS plaats, l.naam AS land, l.begincode FROM type t, accommodatie a, plaats p, land l WHERE t.accommodatie_id=a.accommodatie_id AND a.plaats_id=p.plaats_id AND a.tonen=1 AND a.archief=0 AND t.tonen=1 ORDER BY p.naam, a.naam, t.type_id, t.naam, t.maxaantalpersonen;");
	if($db->num_rows()) {
		echo "<select name=\"types\" id=\"types\" multiple=\"multiple\" style=\"width:550px\">";
		while($db->next_record()) {
#			$vars["top10_types"][$db->f("type_id")]=substr($db->f("plaats")." - ".$db->f("accommodatie").($db->f("type") ? " ".$db->f("type") : ""),0,50)." (".$db->f("optimaalaantalpersonen").($db->f("maxaantalpersonen")>$db->f("optimaalaantalpersonen") ? "-".$db->f("maxaantalpersonen") : "")."p - ".$db->f("begincode").$db->f("type_id").") ";
			echo "<option value=\"".$db->f("type_id")."\">".htmlentities(substr($db->f("plaats")." - ".$db->f("accommodatie").($db->f("type") ? " ".$db->f("type") : ""),0,50)." (".$db->f("optimaalaantalpersonen").($db->f("maxaantalpersonen")>$db->f("optimaalaantalpersonen") ? "-".$db->f("maxaantalpersonen") : "")."p - ".$db->f("begincode").$db->f("type_id").") ")."</option>";
		}
		echo "</select>";
		echo "<input type=\"button\" value=\"Toevoegen\" id=\"typeTypeIDToevoegen\">";
	} else {
		echo "nog geen types aanwezig";
	}
	echo "</td></tr></table>";
echo "</div>";
echo "<div style=\"display:inline\" id=\"subLeveranciersTypes\">";

echo "<table><tr><td>Alle types van een leverancier (types worden los toegevoegd)</td><td>";
	$db->query("SELECT DISTINCT lev.leverancier_id, lev.naam FROM leverancier lev, accommodatie a, type t, plaats p, land l WHERE t.accommodatie_id=a.accommodatie_id AND a.plaats_id=p.plaats_id AND p.land_id=l.land_id AND t.leverancier_id=lev.leverancier_id AND lev.beheerder=0 AND a.tonen=1 AND t.tonen=1 AND a.archief=0 ORDER BY lev.naam, l.naam;");
	if($db->num_rows()) {
		echo "<select name=\"leveranciers_types\" id=\"leveranciers_types\" style=\"width:550px\">";
		while($db->next_record()) {
			echo "<option value=\"".$db->f("leverancier_id")."\">".htmlentities($db->f("naam"))."</option>";
		}
		echo "</select>";
		echo "<input type=\"button\" value=\"Ophalen\" id=\"typeLevIDOphalen\">";
		echo "<select name=\"leveranciers_types_types\" id=\"leveranciers_types_types\" multiple=\"multiple\" style=\"width:550px\">";
		echo "</select>";
		echo "<input type=\"button\" value=\"Toevoegen\" id=\"typeLevIDToevoegen\">";
	} else {
		echo "nog geen leveranciers aanwezig";
	}
	echo "</td></tr></table>";

echo "</div>";

echo "<div style=\"display:inline\" id=\"opslaanKnop\">";
echo "Geef deze groep een naam: <input type=\"text\" value=\"\" id=\"NaamInput\">";
echo "<input type=\"button\" value=\"Opslaan\" id=\"SaveButton\">";
echo "</div>";

echo "<div style=\"display:none\" id=\"groepenkoppelen\">";
echo "<hr/>";
echo "<h2>Leveranciers aan groepen koppelen</h2>";
echo "<table><tr><td>Leveranciers</td><td>";
	$db->query("SELECT DISTINCT lev.leverancier_id, lev.naam FROM leverancier lev, accommodatie a, type t, plaats p, land l WHERE t.accommodatie_id=a.accommodatie_id AND a.plaats_id=p.plaats_id AND p.land_id=l.land_id AND t.leverancier_id=lev.leverancier_id AND lev.beheerder=0 AND a.tonen=1 AND t.tonen=1 AND a.archief=0 ORDER BY lev.naam, l.naam;");
	if($db->num_rows()) {
		echo "<select name=\"leveranciers_types_koppeling\" id=\"leveranciers_types_koppeling\" style=\"width:550px\">";
		while($db->next_record()) {
			echo "<option value=\"".$db->f("leverancier_id")."\">".htmlentities($db->f("naam"))."</option>";
		}
		echo "</select>";
	} else {
		echo "nog geen leveranciers aanwezig";
	}
	echo "</td></tr></table>";

echo "<table border=\"1\"><tr><td>Groep namen:</td><td colspan=\"3\">";
$db->query("select id, groepnaam from groep");
if($db->num_rows()) {
		echo "<select name=\"groepnamen_koppeling\" id=\"groepnamen_koppeling\" style=\"width:550px\">";
		while($db->next_record()) {
			echo "<option value=\"".$db->f("id")."\">".htmlentities($db->f("groepnaam"))."</option>";
		}
		echo "</select>";
		echo "<input type=\"button\" value=\"Koppelen\" id=\"levGrKoppelen\">";
	} else {
		echo "nog geen groepen aanwezig";
	}
echo "</td>";
echo "</tr></table>";
echo "</div>";
?>
<script type="text/javascript">;
sessionStorage.type="";
var cal = new CalendarPopup();
$("#groepen").slideToggle();
$("#overzicht").slideToggle();
function getRapport(){
	if(document.getElementById('groepnamen').value==""){
		window.alert("Selecteer a.u.b een groep");
	}
	else if(document.getElementById('Maandeen').value=="" || document.getElementById('Maandtwee').value==""){
		window.alert("Selecteer a.u.b een periode");
	}
	else{
		window.location = "/chalet/cms_bezettingensys.php?periode=true&van=" +document.getElementById('Maandeen').value+"&tot="+document.getElementById('Maandtwee').value+"&groep="+document.getElementById('groepnamen').value;
	}
}

$("#leverancierkoppelen").click(function () {
$("#groepenkoppelen").slideToggle();
});
$("#groepAanMaken").click(function () {
$("#subGroepAanMaken").slideToggle();
});

$("#peralleTypes").click(function () {
$("#subAlleTypes").slideToggle();
$("#opslaanKnop").slideToggle();
});

$("#peralleLevTypes").click(function () {
$("#subLeveranciersTypes").slideToggle();
$("#opslaanKnop").slideToggle();
});

$("#groepenBekijken").click(function () {
$("#groepen").slideToggle();
$("#periode").slideToggle();
});


$("#typeTypeIDToevoegen").click(function () {
	var elements=document.getElementById('types');
	var select;
	for(i=0; i<elements.length;i++){
		select=elements.options[i];
		if(select.selected){
			sessionStorage.type+=select.value;
			sessionStorage.type+=",";
		}
	}
	window.alert("De geselecteerde types zijn in het geheugen gezet.");
});

$("#typeAccIDToevoegen").click(function () {
	var elements=document.getElementById('accommodaties');
	var select;

	for(i=0; i<elements.length;i++){
		select=elements.options[i];
		if(select.selected){
			sessionStorage.type+=select.value;
			sessionStorage.type+=",";
		}
	}
	window.alert("De geselecteerde types zijn in het geheugen gezet.");
});

$("#typeLevIDToevoegen").click(function () {
	var elements=document.getElementById('leveranciers_types_types');
	var select;
	var type="";
	for(i=0; i<elements.length;i++){
		select=elements.options[i];
		if(select.selected){
			sessionStorage.type+=select.value;
			sessionStorage.type+=",";
			window.alert(type);
		}
	}
	window.alert("De geselecteerde types zijn in het geheugen gezet.");
});

$("#SaveButton").click(function () {
	if(document.getElementById("NaamInput").value==""){
		window.alert("Geef a.u.b een naam voor deze groep op");
	}
	else if(sessionStorage.type==""){
		window.alert("Selecteer eerst de types die u bij deze groep wilt zetten");
	}
	else{
		$.getJSON("/chalet/rpc_json.php", {
			"t": 5,
			"types": sessionStorage.type,
			"action": "maakAan",
			"naam": document.getElementById('NaamInput').value
			}, function(data) {
				if(data.ok) {
					window.alert("groep succesvol aangemaakt");
					$("#groepen").slideToggle();
					location.reload();
				}
			});
	}
});
$("#typeLevIDOphalen").click(function () {
	var typ;
	if(document.getElementById('leveranciers_types').value==""){
		window.alert("selecteer een leverancier");
	}
	else{
		$.getJSON("/chalet/rpc_json.php", {
			"t": 5,
			"id": document.getElementById('leveranciers_types').value,
			"action": "alleLevTypes",
			}, function(data) {
			if(data.ok) {
				window.alert("types opgehaald");
				for(i=0;i<data.types.length;i++){
					typ +="<option value="+data.types[i]+">"+data.types[i]+"</option>";
				}
				 $("#leveranciers_types_types").html(typ);
			}

		});
	}
});
$("#levGrKoppelen").click(function () {
	$.getJSON("/chalet/rpc_json.php", {
		"t": 5,
		"levid": document.getElementById('leveranciers_types_koppeling').value,
		"grid": document.getElementById('groepnamen_koppeling').value,
		"action": "koppel",
		}, function(data) {
		if(data.ok) {
			window.alert("koppeling voldaan");
		}
	});
});
function exportFile(){
	window.location = "/chalet/cms_bezettingensys.php?exportFile=true";
}
</script>

<?php
$status["beschikbaar"]="#ccffcc";
$status["Navragen"]="#fcd5b4";
$status["inoptie"]="#ffff00";
$status["viachalet"]="#93cddd";
$status["doorDerden"]="#800080";
$status["geblokeerd"]="#e5e0ec";
$status["nietbeschikbaar"]="#ff2439";
$status["inplaning"]="#FFFFFF";

$beschikbaar = array(
	'fill' => array(
        'type' => PHPExcel_Style_Fill::FILL_SOLID,
        'color' => array('rgb'=>'ccffcc'),
    ),
);
$inplaning = array(
	'fill' => array(
        'type' => PHPExcel_Style_Fill::FILL_SOLID,
        'color' => array('rgb'=>'ffffff'),
    ),
);
$nietbeschikbaar = array(
	'fill' => array(
        'type' => PHPExcel_Style_Fill::FILL_SOLID,
        'color' => array('rgb'=>'ff2439'),
    ),
);
$geblokeerd = array(
	'fill' => array(
        'type' => PHPExcel_Style_Fill::FILL_SOLID,
        'color' => array('rgb'=>'e5e0ec'),
    ),
);
$doorDerden = array(
	'fill' => array(
        'type' => PHPExcel_Style_Fill::FILL_SOLID,
        'color' => array('rgb'=>'800080'),
    ),
);
$viachalet = array(

	'fill' => array(
        'type' => PHPExcel_Style_Fill::FILL_SOLID,
        'color' => array('rgb'=>'93cddd'),
    ),
);
$inoptie = array(

	'fill' => array(
        'type' => PHPExcel_Style_Fill::FILL_SOLID,
        'color' => array('rgb'=>'ffff00'),
    ),
);
$Navragen = array(

	'fill' => array(
        'type' => PHPExcel_Style_Fill::FILL_SOLID,
        'color' => array('rgb'=>'fcd5b4'),
    ),
);

//contactpersoon_contract
echo "<hr/>";

echo "<div style=\"display:none\" id=\"groepen\">";
echo "<h2>Rapportages bekijken</h2>";
echo "<table border=\"1\"><tr><td>Groep namen:</td><td colspan=\"3\">";
$db->query("select groepnaam from groep");
if($db->num_rows()) {
		echo "<select name=\"groepnamen\" id=\"groepnamen\" style=\"width:550px\">";
		while($db->next_record()) {
			echo "<option value=\"".$db->f("groepnaam")."\">".htmlentities($db->f("groepnaam"))."</option>";
		}
		echo "</select>";
	} else {
		echo "nog geen groepen aanwezig";
	}
echo "</td>";
echo "</tr></table>";
echo "</div>";

?>
<div id="periode" style="display:none;">
<form name="periode">
<table>
  <tr>
    <td>Periode:</td>
    <td><input type="text" name=date1 id="Maandeen" readonly="readonly" value="" /><A HREF="#"

   onClick="cal.select(document.forms['periode'].date1,'Maandeen','yyyy-MM-dd'); return false;"
   NAME="Maandeen" ID="Maandeen">Selecteer</A>
    </td>
    <td><input type="text" name=date2 id="Maandtwee" readonly="readonly" value=""><A HREF="#"

   onClick="cal.select(document.forms['periode'].date2,'Maandtwee','yyyy-MM-dd'); return false;"
   NAME="Maandtwee" ID="Maandtwee">Selecteer</A>
    </input>
    </td>
  	<td><input type="button" value="Rapport ophalen" onclick="getRapport()" </td>
  </tr>
  <tr>
  	<td height="20"></td>
  </tr>
  <tr>
  	<td><a href="#" onclick="exportFile()">Excel bestand exporteren</a></td>
  </tr>
</table>
</form>
</div>
<?php

function deep_ksort(&$arr) {
    ksort($arr);
    foreach ($arr as &$a) {
        if (is_array($a) && !empty($a)) {
            deep_ksort($a);
        }
    }
}
echo "<div style=\"\">";
$types=array();
$db->query("SELECT id FROM groep WHERE groepnaam='".addslashes($_GET["groep"])."';");

if($db->next_record()){
	$gid=$db->f("id");
	$db2->query("SELECT type_id FROM type WHERE groep_id ='".addslashes($gid)."';");
	while($db2->next_record()){
		array_push($types, $db2->f(type_id));
	}
	//var_dump($types);
}
if(isset($_GET["exportFile"])=="true"){
		$datumFrom=	$_SESSION["van"];
		$datumTo=$_SESSION["tot"];
		$objPHPExcel = new PHPExcel();
		$sheet = $objPHPExcel->getActiveSheet();
		$sheet->setCellValue('A1', '');
		$sheet->setCellValue('B1', '');
		$sheet->setCellValue('C1', 'Weken');
		$sheet->setCellValue('A2', '');
		$sheet->setCellValue('B2', 'Groepnaam');
		$sheet->setCellValue("C2", "");
		$datumToTo=$datumTo;
		$datumFromFrom=$datumFrom;
		$verschil=$datumToTo-$datumFromFrom;
		$years = floor($verschil / (365*60*60*24));
		$months = floor(($verschil - $years * 365*60*60*24) / (30*60*60*24));
		$days = floor(($diff - $years * 365*60*60*24 - $months*30*60*60*24)/ (60*60*24));
		$a=0;
		$l="C";
		$next_l=$l;
		do{
			$datumFromFrom=strtotime('+1 day', $datumFromFrom);
			$maan=date("M",$datumFromFrom);
			$maan.=" ";
			$maan.=date("Y",$datumFromFrom);
			if(date("l",$datumFromFrom)=="Saturday" and $a<4*$verschil){
				$data=date("d",$datumFromFrom);
				if($a==0 or $a%4*$verschil==0){
					$sheet->setCellValue($next_l."2", $maan);
				}
				$sheet->setCellValue($next_l."3", $data);
				++$next_l;
				$sheet->setCellValue($next_l."3", "");
				++$next_l;
				$sheet->setCellValue($next_l."3", "");
				++$next_l;
				$sheet->setCellValue($next_l."3", "");
				++$next_l;
				$sheet->setCellValue($next_l."3", "");
				++$next_l;
				$sheet->setCellValue($next_l."3", "");
				++$next_l;
				$a++;
			}
		}
		while($datumFromFrom < $datumToTo);
		$huidigerij=4;
		$l="C";
		$next_l=$l;
		$idss=array();
		$excelDagen=array();
		$excelDagen=$_SESSION["dagen"];
		$saturdays=array();
		$saturdays=$_SESSION["saturday"];
		deep_ksort($excelDagen);
		$start=$_SESSION["start"];
		$idss=$_SESSION["ids"];
		//var_dump($excelDagen);
		foreach($idss as $id){
			$sheet->setCellValue("A".$huidigerij,$id);
			$sheet->setCellValue("B".$huidigerij,$_GET["groep"]);

			$next_l="C";
			for($bl=0;$bl<$months;$bl++){
				$tmp=$saturdays[$start];
				$pos=1;
				for($blz=$pos;$blz<32;$blz++){
					//echo "blz ".$blz;
					if($excelDagen[$id][$start][$blz]=="#800080"){
						$sheet->getStyle($next_l.$huidigerij)->applyFromArray($doorDerden);
						++$next_l;
					}
					elseif($excelDagen[$id][$start][$blz]=="#ff2439"){
						$sheet->getStyle($next_l.$huidigerij)->applyFromArray($nietbeschikbaar);
						++$next_l;
					}
					elseif($excelDagen[$id][$start][$blz]=="#ffff00"){
						$sheet->getStyle($next_l.$huidigerij)->applyFromArray($inoptie);
						++$next_l;
					}
					elseif($excelDagen[$id][$start][$blz]=="#fcd5b4"){
						$sheet->getStyle($next_l.$huidigerij)->applyFromArray($Navragen);
						++$next_l;
					}
					elseif($excelDagen[$id][$start][$blz]=="#ccffcc"){
						$sheet->getStyle($next_l.$huidigerij)->applyFromArray($beschikbaar);
						++$next_l;
					}
					elseif($excelDagen[$id][$start][$blz]=="#FFFFFF"){
						$sheet->getStyle($next_l.$huidigerij)->applyFromArray($inplaning);
						++$next_l;
					}
					elseif($excelDagen[$id][$start][$blz]=="#93cddd"){
						$sheet->getStyle($next_l.$huidigerij)->applyFromArray($viachalet);
						++$next_l;
					}
					elseif($excelDagen[$id][$start][$blz]=="#ffff00"){
						$sheet->getStyle($next_l.$huidigerij)->applyFromArray($inoptie);
						++$next_l;
					}
					else{
						$sheet->getStyle($next_l.$huidigerij)->applyFromArray($inplaning);
						++$next_l;
					}
				}
				if($start==12){
					$start=1;
				}
				$start++;
			}
			$huidigerij++;
			$next_l="C";
		}
		$huidigerij+=3;
		$sheet->setCellValue('A'.$huidigerij, "Legenda");
		$huidigerij++;
		$sheet->getStyle('A'.$huidigerij)->applyFromArray($beschikbaar);
		$sheet->setCellValue('A'.$huidigerij, "");
		$sheet->setCellValue('B'.$huidigerij, "Direct beschikbaar");
		$huidigerij++;
		$sheet->getStyle('A'.$huidigerij)->applyFromArray($Navragen);
		$sheet->setCellValue('A'.$huidigerij, "");
		$sheet->setCellValue('B'.$huidigerij, "Navragen bij eigenaar");
		$huidigerij++;
		$sheet->getStyle('A'.$huidigerij)->applyFromArray($inoptie);
		$sheet->setCellValue('A'.$huidigerij, "");
		$sheet->setCellValue('B'.$huidigerij, "Staat in optie voor klant");
		$huidigerij++;
		$sheet->getStyle('A'.$huidigerij)->applyFromArray($viachalet);
		$sheet->setCellValue('A'.$huidigerij, "");
		$sheet->setCellValue('B'.$huidigerij, "Boeking via Chalet.nl");
		$huidigerij++;
		$sheet->getStyle('A'.$huidigerij)->applyFromArray($doorDerden);
		$sheet->setCellValue('A'.$huidigerij, "");
		$sheet->setCellValue('B'.$huidigerij, "Boeking door derde");
		$huidigerij++;
		$sheet->getStyle('A'.$huidigerij)->applyFromArray($geblokeerd);
		$sheet->setCellValue('A'.$huidigerij, "");
		$sheet->setCellValue('B'.$huidigerij, "Geblokkeerd door eigenaar");
		$huidigerij++;
		$sheet->getStyle('A'.$huidigerij)->applyFromArray($nietbeschikbaar);
		$sheet->setCellValue('A'.$huidigerij, "");
		$sheet->setCellValue('B'.$huidigerij, "Niet beschikbaar voor verhuur");
		$huidigerij++;
		$sheet->getStyle('A'.$huidigerij)->applyFromArray($inplaning);
		$sheet->setCellValue('A'.$huidigerij, "");
		$sheet->setCellValue('B'.$huidigerij, "Nog niet in planning");

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('testPHPExcel.xlsx');
		echo "Done writing<BR><BR>";
		echo "<a href=\"testPHPExcel.xlsx\">Download bestand</a><BR><BR>";
		unset($idss);
		unset($excelDagen);

}
if(!isset($_GET["exportFile"]) and $_GET["periode"]=="true"){
	$datumFrom=strtotime($_GET["van"]);
	$datumTo=strtotime($_GET["tot"]);
	$_SESSION["van"]=$datumFrom;
	$_SESSION["tot"]=$datumTo;
	$datumToTo=$datumTo;
	$datumFromFrom=$datumFrom;
	$verschil=$datumToTo-$datumFromFrom;
	$years = floor($verschil / (365*60*60*24));
	$months = floor(($verschil - $years * 365*60*60*24) / (30*60*60*24));
	$days = floor(($diff - $years * 365*60*60*24 - $months*30*60*60*24)/ (60*60*24));
	//$table="<div style=\"width:100%; height:300px;overflow:scroll;\">";
	$table.="<table width=\"100%\" class=\"calenderTable\" border=\"1\" cellspacing=\"0\">";
	$table.="<thead>";
	$table.="<tr>";
	$table.="<th></th>";
	$table.="<th></th>";
	$table.="<th colspan=\"1000\"><b>Weken</b></th>";
	$table.="</tr><tr>";
	$table.="<th></th>";
	$table.="<th><b>Groepnaam</b></th>";
	$table.="<th colspan=\"1000\">";
	$zaterdag = array();
	$table.="</th>";
	$table.="</tr></thead><tbody><tr>";
	//$table.="</tr><tr>";
	$maadenGedaan=0;
	$dagenarr=array();
	$ids=array();
	//$db->query("SELECT DISTINCT type_id FROM view_accommodatie WHERE leverancier_id='130' AND atonen=1 AND ttonen=1;");
	foreach($types as $ty){
		//$db2->query("SELECT type_id FROM type WHERE zomerwinterkoppeling_accommodatie_id='".addslashes($db->f("type_id"))."';");
		//if($db2->next_record()){
		//	$inquery_type_id=$db->f("type_id").",".$db2->f("type_id");
		//}
		//else {
		//	$inquery_type_id=$db->f("type_id");
		//}
	$inquery_type_id=$ty;
	array_push($ids,$ty);
	//echo count($inquery_type_id);

	$result2=$db4->query("SELECT ta.seizoen_id, ta.week, ta.beschikbaar, ta.voorraad_allotment, ta.voorraad_request, ta.voorraad_optie_klant, ta.opmerking_bezeteigenaar, ta.opmerking_boekingderden, ta.opmerking_nietbeschikbaarverhuur FROM tarief ta, accommodatie a, type t WHERE ta.type_id=t.type_id AND t.accommodatie_id=a.accommodatie_id AND ta.week BETWEEN ".addslashes($datumFrom)." AND ".addslashes($datumTo)." AND ta.type_id IN ('".addslashes($inquery_type_id)."') ORDER BY ta.week ASC;");
	if(count($result2)>0){
		while($row2=mysql_fetch_array($result2)){
			if(!$row2["beschikbaar"] and $row2["opmerking_bezeteigenaar"]) {
				$stat2=$status["geblokeerd"];
			}
			elseif(!$row2["beschikbaar"] and $row2["opmerking_boekingderden"]){
				$stat2=$status["doorDerden"];
			}
			elseif(!$row2["beschikbaar"] and $row2["opmerking_nietbeschikbaarverhuur"]){
				$stat2=$status["nietbeschikbaar"];
			}
			if($row2["voorraad_optie_klant"]){
				$stat2=$status["inoptie"];
			}
			elseif($row2["voorraad_allotment"]) {
				$stat2=$status["beschikbaar"];
			}
			elseif($row2["voorraad_request"]){
				$stat2=$status["Navragen"];
			}
			if($row2["voorraad_optie_klant"]){
				$stat=$status["inoptie"];
			}
			elseif($row2["voorraad_allotment"]) {
				$stat=$status["beschikbaar"];
			}
			elseif($row2["voorraad_request"]){
				$stat=$status["Navragen"];
			}

			if(!$row2["beschikbaar"] and $row2["opmerking_bezeteigenaar"]) {
				$stat2=$status["geblokeerd"];
			}
			elseif(!$row2["beschikbaar"] and $row2["opmerking_boekingderden"]){
				$stat2=$status["doorDerden"];
			}
			elseif(!$row2["beschikbaar"] and $row2["opmerking_nietbeschikbaarverhuur"]){
				$stat2=$status["nietbeschikbaar"];
			}
			if($row2["voorraad_optie_klant"]){
				$stat2=$status["inoptie"];
			}
			elseif($row2["voorraad_allotment"]) {
				$stat2=$status["beschikbaar"];
			}
			elseif($row2["voorraad_request"]){
				$stat2=$status["Navragen"];
			}
			$dagenarr[$inquery_type_id][date("m",$row2["week"])+0][date("d",$row2["week"])+0]=$stat;
			//$maand=date("m",$row2["week"])+0;
			//$dag=date("d",$row2["week"])+0;
			//$dagenarr[$inquery_type_id][$maand][$dag]=$stat;
			for($abc=0;$abc<6;$abc++){
				$dagenarr[$inquery_type_id][$maand][$dag]=$stat;
				$dag++;
			}
		}
	}
	$result=$db3->query("SELECT b.aankomstdatum_exact, b.vertrekdatum_exact, UNIX_TIMESTAMP(b.besteldatum) AS besteldatum, bp.voornaam, bp.tussenvoegsel, bp.achternaam FROM boeking b, boeking_persoon bp WHERE b.aankomstdatum_exact BETWEEN ".addslashes($datumFrom)." AND ".addslashes($datumTo)." AND bp.boeking_id=b.boeking_id AND bp.persoonnummer=1 AND (b.type_id IN (".addslashes($inquery_type_id).") OR b.verzameltype_gekozentype_id IN (".addslashes($inquery_type_id).")) AND b.seizoen_id>=17 AND b.goedgekeurd=1 AND b.geannuleerd=0 AND b.boekingsnummer<>'';");
	if(count($result)>0){
		while($row=mysql_fetch_array($result)){
			if($row["besteldatum"]>0 or $row["vertrekdatum_exact"]<time()) {
				$stat=$status["viachalet"];
			}
			else {
				$stat=$status["inoptie"];
			}
			$aankomst=date("d",$row["aankomstdatum_exact"]);
			$vertrek=date("d",$row["vertrekdatum_exact"]);
			if(date("d",$row["aankomstdatum_exact"]) > date("d",$row["vertrekdatum_exact"])){
				$tussentijd=$aankomst+$vertrek;
				if($tussentijd>30){
					$tussentijd = 31;
				}
				for($z=$aankomst+0; $z<$tussentijd; $z++){
					$dagenarr[$inquery_type_id][date("m",$row["aankomstdatum_exact"])+0][$z]=$stat;
					$bezet[date("m",$row["aankomstdatum_exact"])+0][$z]=$z;
				}
			}
			else{
				for($y=$aankomst+0;$y<$vertrek;$y++){
					$dagenarr[$inquery_type_id][date("m",$row["aankomstdatum_exact"])+0][$y]=$stat;
					$bezet[date("m",$row["aankomstdatum_exact"])+0][$y]=$y;
				}
			}
		}
	}

	$table.="<td>".$inquery_type_id."</td>";
	$table.="<td>".$_GET["groep"]."</td>";
	$table.="<td>";
	$table.="<table border=\"1\" cellspacing=\"0\" width=\"100%\">";
	$table.="<tbody><tr>";
	if($maadenGedaan==0){
	$data=date("M",$datumFromFrom);

	$table.="<td colspan=\"31\" width=\"5\">".$data."</td>";

	if($months > 1){
		for($ble=1;$ble<$months;$ble++){
		$datumFromFrom=strtotime('+1 month', $datumFromFrom);
			if($a<$months){
				$data=date("M",$datumFromFrom);
				$table.="<td align=\"left\" colspan=\"31\" width=\"5\">".$data."</td>";
				$a++;
			}
		}
	}
	$table.="</tr></tbody><tbody><tr>";
		$datumFromFrom = $datumFrom;
	$z=0;
	do{
		for($x=1;$x<31;$x++){
			$datumFromFrom=strtotime('+1 day', $datumFromFrom);
			if(date("l",$datumFromFrom)=="Saturday"){
				$zaterdag[date("m",$datumFromFrom)+0][$pos]=date("d",$datumFromFrom);
				$pos++;
				$data=date("d",$datumFromFrom);
				$table.="<td align=\"left\" width=\"5\">".$data."</td>";
				$table.="<td style=\"color:#FFFFFF\" width=\"5\">".$data."</td>";
				$table.="<td style=\"color:#FFFFFF\" width=\"5\">".$data."</td>";
				$table.="<td style=\"color:#FFFFFF\" width=\"5\">".$data."</td>";
				$table.="<td style=\"color:#FFFFFF\" width=\"5\">".$data."</td>";
				$table.="<td style=\"color:#FFFFFF\" width=\"5\">".$data."</td>";
			}
		}
		//$datumFromFrom=strtotime('+1 month', $datumFromFrom);
	}
	while($datumFromFrom < $datumToTo);
	//var_dump($zaterdag);
		$table.="</tr>";
		$table.="</tbody>";
		$table.="</table>";
		$maadenGedaan++;
	}
	$table.="<table border=\"1\" cellspacing=\"0\" width=\"100%\">";
	$table.="<tbody>";
	$table.="<tr>";
	$datumToTo=$datumTo;
	$datumFromFrom=$datumFrom;
	$table.="<tbody><tr>";
		deep_ksort($dagenarr);
		$begin=date("m",$datumFromFrom)+0;
		$_SESSION["start"]=$begin;
		for($f=0;$f<$months;$f++){
			$tmp=$zaterdag[$begin];
			session_register("zaterdag");
			$_SESSION["saturday"]=$zaterdag;
			for($g=1;$g<31;$g++){

				if(in_array($g,$tmp)){
					if(substr($dagenarr[$inquery_type_id][$begin][$g],0,1)!="#"){
						$table.="<td align=\"left\"  width=\"5\"  height=\"10\" style=\"color:#FFFFFF\" bgcolor=\"#FFFFFF\"></td>";
						$table.="<td align=\"left\"  width=\"5\"  height=\"10\" style=\"color:#FFFFFF\" bgcolor=\"#FFFFFF\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:#FFFFFF\" bgcolor=\"#FFFFFF\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:#FFFFFF\" bgcolor=\"#FFFFFF\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:#FFFFFF\" bgcolor=\"#FFFFFF\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:#FFFFFF\" bgcolor=\"#FFFFFF\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" bgcolor=\"#FFFFFF\"></td>";
					}
					else{
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:".$dagenarr[$db->f("type_id")][$begin][$g]."\" bgcolor=\"".$dagenarr[$db->f("type_id")][$begin][$g]."\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:".$dagenarr[$db->f("type_id")][$begin][$g]."\" bgcolor=\"".$dagenarr[$db->f("type_id")][$begin][$g]."\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:".$dagenarr[$db->f("type_id")][$begin][$g]."\" bgcolor=\"".$dagenarr[$db->f("type_id")][$begin][$g]."\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:".$dagenarr[$db->f("type_id")][$begin][$g]."\" bgcolor=\"".$dagenarr[$db->f("type_id")][$begin][$g]."\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:".$dagenarr[$db->f("type_id")][$begin][$g]."\" bgcolor=\"".$dagenarr[$db->f("type_id")][$begin][$g]."\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" style=\"color:".$dagenarr[$db->f("type_id")][$begin][$g]."\" bgcolor=\"".$dagenarr[$db->f("type_id")][$begin][$g]."\"></td>";
						$table.="<td align=\"left\"  width=\"5\"	height=\"10\" bgcolor=\"".$dagenarr[$db->f("type_id")][$begin][$g]."\"></td>";
					}
				}
			}
			if($begin==12){
				$begin=1;
			}
			else{
				$begin++;
			}
		}
	$table.="</tr>";
	$table.="</tbody>";
	$table.="</table>";
	$table.="</tr><tr>";
	}
	//tot hier herhalen
	$table.="</td>";
	$table.="</tr><tr>";

	$table.="</tr>";
	$table.="</tbody>";
	$table.="</table>";
	//$table.="</div>";
	echo $table;
	session_register("dagen");
	$_SESSION["dagen"]=$dagenarr;
	session_register("ids");
	$_SESSION["ids"]=$ids;
	unset($dagenarr);
	unset($ids);
	echo "<BR><BR><BR>";
}
else{
	echo "<BR><BR><b>Geen periode geselecteerd</b><BR><BR>";
}
echo "</div>";
?>

<table width="60%" border="0">
	<tr>
	<td colspan="2"><b>Legenda</b></td>
	</tr>
	<tr>
		<td bgcolor="#ccffcc" width="5%"></td><td>Direct beschikbaar</td>
	</tr>
	<tr>
		<td bgcolor="#fcd5b4" width="5%"></td><td>Navragen bij eigenaar</td>
	</tr>
	<tr>
		<td bgcolor="#e5e0ec" width="5%"></td><td>Geblokkeerd door eigenaar</td>
	</tr>
	<tr>
		<td bgcolor="#800080" width="5%"></td><td>Boeking door derde</td>
	</tr>
	<tr>
		<td bgcolor="#ff2439" width="5%"></td><td>Niet beschikbaar voor verhuur</td>
	</tr>
	<tr>
		<td bgcolor="#ffff00" width="5%"></td><td>Staat in optie voor klant</td>
	</tr>
	<tr>
		<td bgcolor="#93cddd" width="5%"></td><td>Boeking via Chalet.nl</td>
	</tr>
	<tr>
		<td bgcolor="#FFFFFF" width="5%"></td><td>Nog niet in planning</td>
	</tr>
</table>