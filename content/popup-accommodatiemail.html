<style type="text/css">
#mailTable{
	width:80%;
	font-family:Verdana, Geneva, sans-serif;
	font-size:12px;	
}

#mailTable td{
	width:100px;
}

</style>
<script type="text/javascript">
function validateEmail(email) {  
	var pattern = /^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/;
	return email.match(pattern);     
}  

function controlEnSend(){
	if(document.getElementById("verzenderAdres").value == ""){
		//window.alert("OK");
		document.getElementById("Verzender").style.backgroundColor = 'red';
		document.getElementById("Verzender").style.color = 'white';
		document.getElementById("Verzender").style.padding = '10px';
		document.getElementById("Verzender").innerHTML = "U heeft uw email adres niet ingevuld";
	}
	else if(document.getElementById("EmailOntvanger").value == ""){
		//window.alert("OK");
		document.getElementById("Verzender").style.backgroundColor = 'red';
		document.getElementById("Verzender").style.color = 'white';
		document.getElementById("Verzender").style.padding = '10px';
		document.getElementById("Verzender").innerHTML = "U heeft het emailadres (de emailadressen) van de ontvanger(s) niet ingevuld";
	}
	else{
		var container = document.getElementById("EmailOntvanger").value;
		var emailAdressen = container.split(" ");
		for(var i =0; i < emailAdressen.length; i++){
			if(!validateEmail(emailAdressen[i])){
				window.alert(emailAdressen[i] + " is geen geldige email adres. Geef aub alleen maar geldige email adressen op.");
				document.getElementById("Verzender").style.backgroundColor = 'red';
				document.getElementById("Verzender").style.color = 'white';
				document.getElementById("Verzender").style.padding = '10px';
				document.getElementById("Verzender").innerHTML = "Vul A.u.b geldige email adres(sen) in";
				break;
			}
			else{
				var bericht = document.getElementById("presentbericht").innerHTML;
				//window.alert(bericht);
				bericht=bericht.replace(/\n\r?/g, '<br/>'); 	
				document.getElementById("bericht2").value = bericht;
				document.forms["mailAcc"].submit();
				break;
			}
		}
	}
}
</script>

<?php
if($vars["websitetype"]==1){
	$vars["mail_topfoto"]=$vars["basehref"]."pic/topfoto/headerChalet.png";
	$vars["mail_form_mid_div_content"]="Ik heb een leuk chalet/appartement gevonden op Chalet.nl. Dit moet je zien!";
	$vars["mail_form_aLink_style"]="color:#002682; font-family:Verdana, Geneva, sans-serif; text-decoration:none;";
	$vars["balkkleur"]="#003366";
	$vars["backcolor"]="#d5e1f9";
	$vars["textColor"]="#003366";
	$vars["korteOmschrijvinkleur"]="#d40139";
}
elseif($vars["websitetype"]==3){
	$vars["mail_topfoto"]=$vars["basehref"]."pic/topfoto/headerZomerhuisje.png";
	$vars["mail_form_mid_div_content"]="Ik heb een leuk vakantiehuis gevonden op zomerhuisje.nl. Dit moet je zien!";
	$vars["mail_form_aLink_style"]="color:#5f227b; font-family:Verdana, Geneva, sans-serif; text-decoration:none;";
	$vars["balkkleur"]="#5f227b";
	$vars["backcolor"]="#eaeda9";
	$vars["textColor"]="#5f227b";
	$vars["korteOmschrijvinkleur"]="#5f227b";
}
elseif($vars["websitetype"]==7){
	$vars["mail_topfoto"]=$vars["basehref"]."pic/topfoto/headerItalissima.png";
	$vars["mail_form_mid_div_content"]="Ik heb een aantal leuke chalets en appartementen gevonden op italissima.nl. Dit moet je zien!";
	$vars["mail_form_aLink_style"]="color:#fe9900; font-family:Verdana, Geneva, sans-serif; text-decoration:none;";
	$vars["balkkleur"]="#661700";
	$vars["backcolor"]="#ffd699";
	$vars["textColor"]="#661700";
	$vars["korteOmschrijvinkleur"]="#661700";
}
# Gegevens gekozen accommodatie opvragen
$accinfo=accinfo($_GET["accid"]);
//echo "<p>Naam accommodatie: ".wt_he($accinfo["accnaam"])."</p>";

//echo "<p>Meer informatie over deze accommodatie: ".wt_dump($accinfo)."</p>";

if(isset($_POST['verzenderAdres'])){
	if($_POST['jaNee']=="on"){
		$mail=new wt_mail;
		$mail->fromname=$_POST["verzenderAdres"];
		$mail->from=$_POST['verzenderAdres'];
		$mail->toname=$_POST[''];
		$mail->to=$_POST['verzenderAdres'];
		$mail->subject=wt_he($accinfo["accnaam"]);
		$mail->plaintext=""; # deze leeg laten bij een opmaak-mailtje
		$mail->html_top="";
		$mail->html.="<html>";
		$mail->html.="<head>";
		$mail->html.="</head>";
		$mail->html.="<body style=\"font-family:verdana;\">";
		$mail->html.="<div style=\"width:681px; position:absolute; left:10%;\">";
		$mail->html.="<br><i>Deze mail is een kopie van de accommodatie welke jijzelf hebt doorgestuurd op ".$vars["websitenaam"]."</i><br><br>";
		$mail->html.="<a href=".$vars["basehref"]."><img src=".$vars['mail_topfoto']."></a><BR><BR>";
		$mail->html.="<BR><div style=\"color:".$vars["textColor"].";text-align:left;width:681px;\">".nl2br($_POST['bericht'])."</div>\n";
		$mail->html.=$_POST['bericht2']."\n";
		$mail->html.="</div>";
		$mail->html.="</body>";
		$mail->html.="</html>";
		$mail->html_bottom="";
		$mail->send();
	}
	$emails = explode(" ", $_POST['EmailOntvanger']);
	for($i = 0; $i<sizeof($emails); $i++){
		$mail=new wt_mail;
		$mail->fromname=$_POST["verzenderAdres"];
		$mail->from=$_POST['verzenderAdres'];
		$mail->toname=$_POST[''];
		$mail->to=$emails[$i];
		$mail->subject=wt_he($accinfo["accnaam"]);
		$mail->plaintext=""; # deze leeg laten bij een opmaak-mailtje
		$mail->html_top="";
		$mail->html.="<html>";
		$mail->html.="<head>";
		$mail->html.="</head>";
		$mail->html.="<body style=\"font-family:verdana;\">";
		$mail->html.="<div style=\"width:681px; position:absolute; left:10%;\">";
		$mail->html.="<a href=".$vars["basehref"]."><img src=".$vars['mail_topfoto']."></a><BR><BR>";
		$mail->html.="<BR><div style=\"color:".$vars["textColor"].";text-align:left;width:681px;\">".nl2br($_POST['bericht'])."</div>\n";
		$mail->html.=$_POST['bericht2']."\n";
		$mail->html.="</div>";
		$mail->html.="</body>";
		$mail->html.="</html>";
		$mail->html_bottom="";
		$mail->send(); # mailtje daadwerkelijk verzenden
	}
	echo "<b>Bedankt, uw email(s) zijn verzonden</b>";
}

?>
<form action="<?php echo $_SERVER["REQUEST_URI"] ?>"  method="post" name="mailAcc">
	<table id="mailTable">
		<tr>
			<td><strong>Van: (Email adres)</strong></td>
		</tr>
		<tr>
			<td>
				<input type="text" name="verzenderAdres" id="verzenderAdres" />
			</td>
		</tr>
		<tr>
			<td><strong>Naar: (Meerdere emailadressen scheiden met een spatie)</strong></td>
		</tr>
		<tr>
			<td><input type="text" name="EmailOntvanger" id="EmailOntvanger" /></td>
		</tr>
		<tr>
			<td><strong>Bericht:</strong></td>
		</tr>
		<tr>
			<td><textarea name="bericht" id="bericht" cols="50" rows=7 /><?php echo $vars['mail_form_mid_div_content'];?></textarea></td>
		</tr>
		<tr>
			<td>
				<div id="presentbericht" contenteditable="true">
					<p><BR />
						<?php
							if(wt_he($accinfo["optimaalaantalpersonen"])==wt_he($accinfo["maxaantalpersonen"])){
								$rev=wt_he($accinfo["optimaalaantalpersonen"]);
							}
							else{
								$rev=wt_he($accinfo["optimaalaantalpersonen"])." - ".wt_he($accinfo["maxaantalpersonen"]);
							}
							echo"<table style=\"display:inline-table;background-color:".$vars["backcolor"].";font-family:verdana\" text-align=\"left\" border=\"0\" width=\"681px\" bgcolor=\"".$vars["backcolor"]."\">";
							echo"<tr><td bgcolor=\"".$vars["balkkleur"]."\" colspan=\"2\" style=\"color:#FFFFFF; padding-left:5px;\">".wt_he($accinfo["accnaam"])."</td></tr>";
							$impath=$vars["basehref"].$accinfo["hoofdfoto"]; 
							$url="url";
							echo"<tr><td width=\"220px\" valign=\"top\" rowspan=\"8\"><a href=\"$accinfo[$url]\"><img src=\"$impath\" width=\"220px\" border=\"0\"/></a></td>";
							echo"<td style=\"text-align:left;\" width=\"461px\"><b>".wt_he($accinfo["land"])."</b></td></tr><tr>";
							echo"<td width=\"461px\">".wt_he($accinfo["plaats"])."</td></tr><tr>";
							echo "<td width=\"461px\">".wt_he($accinfo["skigebied"])."</td><tr><tr>";
							echo"<td width=\"461px\" style=\"color:".$vars["korteOmschrijvinkleur"].";\">".wt_he($accinfo["korteomschrijving"])."</td></tr><tr>";
							echo"<td width=\"461px\">".$rev." personen</td></tr><tr>";
							echo"<td width=\"461px\">".wt_he($accinfo["slaapkamers"])." slaapkamer(s)</td></tr><tr>";
							echo"<td valign=\"top\" width=\"461px\">".wt_he($accinfo["badkamers"])." badkamer(s)</td></tr>";
							echo"<td width=\"461px\"></td><td style=\"color:".$vars["backcolor"]."\">jhdgsjhgsdhjgsdjhgdsjgsdhjgjhsdghjgsdjhgdkjhshsdkhjfhgdfkjghfkjf</td></tr>";
							echo"</table>";
						?>
				</div>
				<input type="hidden" name="bericht2" id="bericht2"></input>	
				<div id="Verzender"></div></td>
		</tr>
		<tr>
			<td><input type="checkbox" name="jaNee" id="jaNee"> Stuur een kopie naar mezelf</td>
		</tr>
		<tr>
			<td><button type="button" onclick="controlEnSend()" name="verzend" id="verzend" value="VERZENDEN">VERZENDEN</button>
			</td>
		</tr>
	</table>
</form>