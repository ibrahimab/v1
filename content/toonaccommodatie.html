<?php
use Chalet\Frontend\Accommodation\ExtraDistances\ExtraDistances;
use Chalet\Frontend\Accommodation\ExtraDistances\Repository as ExtraDistancesRepository;

#
# Favorieten-popup tonen en correct positioneren
#

if($vars["websitetype"]==3) {
	# Vormgeving: Zomerhuisje.nl, Zomerhuisje.eu
	$popup_url="favorieten_popup_background_zomerhuisje";
} elseif($vars["websitetype"]==7) {
	# Vormgeving: Italissima
	$popup_url="favorieten_popup_background_italissima";
} elseif($vars["websitetype"]==8) {
	# Vormgeving: SuperSki
	$popup_url="favorieten_popup_background_superski";
} elseif($vars["websitetype"]==9) {
	# Vormgeving: Venturasol
	$popup_url="favorieten_popup_background_venturasol";
} else {
	# Vormgeving: alle andere sites
	$popup_url="favorieten_popup_background";
}

if($vars["website"]=="I") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:372px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="K") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:314px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="H") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:300px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="E") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:265px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="Z") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:202px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="N") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:165px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="T") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:262px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="W") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:308px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="X") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:174px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="Y") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:235px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} elseif($vars["website"]=="D") {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:145px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
} else {
	echo "<div style=\"position:absolute;top:11px;\"><div id=\"favorieten_popup\" style=\"margin-left:220px;width:305px; height:160px;background-image:url(".$vars["path"]."pic/".$popup_url.".png);background-repeat:no-repeat; padding:5px; font-size:12px; text-align:center; display:none;\">";
}
echo "<div style=\"padding-top:55px;padding-left:10px;padding-right:10px;width:270px;\">".html("jefavorietenwordenopgeslagen","favorieten")."<div style=\"margin-top:10px;\"><input type=\"button\" value=\"OK\" onClick=\"$('#favorieten_popup').css('display','none');\"></div></div>";
echo "</div>";
echo "</div>";

if($_GET["cmsuit"]) {
	unset($voorkant_cms);
}

if($_GET["d"]) {
	$aankomstdatum=$_GET["d"];
	if(!$_GET["optie_datum"]) $_GET["optie_datum"]=$_GET["d"];
}

$accinfo=accinfo($typeid);
$toonper=$accinfo["toonper"];

# Zijn de tarieven al bekend?
if($toonper==3 or $vars["wederverkoop"]) {
	$db2->query("SELECT DISTINCT t.seizoen_id, s.naam".$vars["ttv"]." AS naam, s.optietarieventonen, UNIX_TIMESTAMP(s.begin) AS begin, UNIX_TIMESTAMP(s.eind) AS eind FROM seizoen s, tarief t WHERE s.tonen>1 AND s.type='".$vars["seizoentype"]."' AND s.seizoen_id=t.seizoen_id AND t.type_id='".addslashes($typeid)."' ORDER BY s.begin, s.eind;");
	while($db2->next_record()) {
		$seizoen_tarieven[$db2->f("seizoen_id")]=$db2->f("naam");
		$optietarieventonen[$db2->f("seizoen_id")]=$db2->f("optietarieventonen");
		$seizoen_begin[$db2->f("seizoen_id")]=$db2->f("begin");
		$seizoen_eind[$db2->f("seizoen_id")]=$db2->f("eind");
	}
} else {
	$db2->query("SELECT DISTINCT tp.seizoen_id, s.naam".$vars["ttv"]." AS naam, s.optietarieventonen, UNIX_TIMESTAMP(s.begin) AS begin, UNIX_TIMESTAMP(s.eind) AS eind FROM seizoen s, tarief_personen tp WHERE s.tonen>1 AND s.type='".$vars["seizoentype"]."' AND s.seizoen_id=tp.seizoen_id AND tp.type_id='".addslashes($typeid)."' ORDER BY s.begin, s.eind;");
	while($db2->next_record()) {
		$seizoen_tarieven[$db2->f("seizoen_id")]=$db2->f("naam");
		$optietarieventonen[$db2->f("seizoen_id")]=$db2->f("optietarieventonen");
		$seizoen_begin[$db2->f("seizoen_id")]=$db2->f("begin");
		$seizoen_eind[$db2->f("seizoen_id")]=$db2->f("eind");
	}
	# Skipasgegevens uit database halen
	$db->query("SELECT s.website_omschrijving".$vars["ttv"]." AS website_omschrijving FROM skipas s, accommodatie a WHERE a.skipas_id=s.skipas_id AND a.accommodatie_id='".addslashes($accinfo["accommodatie_id"])."';");
	if($db->next_record()) {
		if($db->f("website_omschrijving")) $skipas_website_omschrijving=$db->f("website_omschrijving");
	}
}

#
# Tarieventabellen inladen
#

if($_COOKIE["oude_tarieventabel"]<>1 or !$voorkant_cms) {
	$nieuwe_tarieventabel=true;
}

$nieuwe_tarieventabel_seizoen_id_inquery="0";
unset($tarieventabel);
@reset($seizoen_tarieven);
while(list($key_s,$value_s)=@each($seizoen_tarieven)) {
	$seizoenid=$key_s;
	$seizoenteller++;
	$aanbieding[$seizoenid]=aanbiedinginfo($typeid,$seizoenid);
	if(is_array($aanbieding[$seizoenid])) {
		foreach ($aanbieding[$seizoenid] as $tempkey => $tempvalue) {
			if(is_array($tempvalue)) {
				// er is een tekstaanbieding: aanbieding is dus actief
				$aanbieding_actief=true;
			}
		}
	}

	$vandaag=mktime(0,0,0,date("m"),date("d"),date("Y"));
	$db->query("SELECT korting_id, onlinenaam".$vars["ttv"]." AS onlinenaam, omschrijving".$vars["ttv"]." AS omschrijving, UNIX_TIMESTAMP(tot) AS tot FROM korting WHERE actief=1 AND xml_korting=0 AND onlinenaam".$vars["ttv"]."<>'' AND omschrijving".$vars["ttv"]."<>'' AND type_id='".addslashes($typeid)."' AND seizoen_id='".addslashes($seizoenid)."' AND UNIX_TIMESTAMP(van)<='".$vandaag."' AND UNIX_TIMESTAMP(tot)>='".$vandaag."';");
	while($db->next_record()) {
		$aanbieding[$seizoenid]["aanbiedingid_sort"]["korting_".$db->f("korting_id")]["soort"]=$db->f("onlinenaam");
		$aanbieding[$seizoenid]["aanbiedingid_sort"]["korting_".$db->f("korting_id")]["omschrijving"]=$db->f("omschrijving");
		$aanbieding[$seizoenid]["aanbiedingid_sort"]["korting_".$db->f("korting_id")]["einddatum"]=$db->f("tot");
		$aanbieding[$seizoenid]["aanbiedingid_sort"]["korting_".$db->f("korting_id")]["toon_als_aanbieding"]=true;
		$db2->query("SELECT week FROM korting_tarief WHERE korting_id='".$db->f("korting_id")."';");
		while($db2->next_record()) {
			$aanbieding[$seizoenid]["aanbiedingid_sort"]["korting_".$db->f("korting_id")]["weken"][$db2->f("week")]=true;
		}
	}

	if($nieuwe_tarieventabel) {
		//
		// nieuwe tarieventabel
		//

		$nieuwe_tarieventabel_seizoen_id_inquery.=",".$seizoenid;

	} else {
		//
		// oude tarieventabel
		//
		ob_start();
		include("content/tarieventabel.html");
		$tarieventabel[$seizoenid]=ob_get_contents();
		ob_end_clean();
		if($tarieven_getoond[$seizoenid]) {
			if($seizoenen_inquery) $seizoenen_inquery.=",".$seizoenid; else $seizoenen_inquery=$seizoenid;
			if($oranjebedragen_row_getoond) {
				$aanbieding_actief=true;
			}
		}
	}
}

if($nieuwe_tarieventabel) {


	$tarieventabel_object = new tarieventabel;

	$tarieventabel_object->show_afwijkend_legenda = true;
	if($weekendski) {
		$tarieventabel_object->show_afwijkend_legenda = false;
	}

	// interne informatie tonen?
	if($voorkant_cms and $_COOKIE["loginuser"]["chalet"]<>15 and $_COOKIE["loginuser"]["chalet"]<>26) {
		$tarieventabel_object->toon_interne_informatie = true;
	}

	// beschikbaarheid tonen aan reisagenten?
	if($vars["wederverkoop"] and (($vars["chalettour_logged_in"] and $vars["wederverkoop_beschikbaarheid_inzien"]) or $tarieventabel_object->toon_interne_informatie)) {
		$tarieventabel_object->toon_beschikbaarheid = true;
	}

	// commissie tonen aan reisagenten?
	if($vars["wederverkoop"] and (($vars["chalettour_logged_in"] and $vars["wederverkoop_commissie_inzien"]) or $tarieventabel_object->toon_interne_informatie)) {
		$tarieventabel_object->toon_commissie = true;
	}

	// andere valuta tonen
	if($vars["website"]=="E") {
		$tarieventabel_object->meerdere_valuta = true;
		$tarieventabel_object->actieve_valuta = "euro";
	}



	$tarieventabel_object->seizoen_id=$nieuwe_tarieventabel_seizoen_id_inquery;
	$tarieventabel_object->type_id=$typeid;

	$tarieventabel_object_content = $tarieventabel_object->toontabel();

	if($tarieventabel_object->tarieven_getoond) {

		$tarieven_getoond=$tarieventabel_object->tarieven_getoond;

		$echt_tarieven_getoond=true;

		foreach ($tarieventabel_object->tarieven_getoond as $key0 => $value0) {
			if($seizoenen_inquery) $seizoenen_inquery.=",".$key0; else $seizoenen_inquery=$key0;
		}

		$tarieventabel[$seizoenid]=$tarieventabel_object_content;

		if($tarieventabel_object->aanbieding_actief) {
			$aanbieding_actief=true;
		}
	}

	if($tarieventabel_object->tarieven_ingevoerd) {
		$tarieven_ingevoerd=true;
	}
}

$db->query("SELECT DISTINCT a.wzt, a.accommodatie_id, a.naam, a.flexibel, a.altnaam_zichtbaar, a.korteomschrijving".$vars["ttv"]." AS korteomschrijving, a.kenmerken_gecontroleerd, a.url_leverancier AS aurl_leverancier, t.zomerwinterkoppeling_accommodatie_id, t.code, t.altnaam_zichtbaar AS taltnaam_zichtbaar, t.naam".$vars["ttv"]." AS tnaam, t.korteomschrijving".$vars["ttv"]." AS tkorteomschrijving, t.url_leverancier AS turl_leverancier, t.verzameltype, a.soortaccommodatie, a.omschrijving".$vars["ttv"]." AS omschrijving, t.omschrijving".$vars["ttv"]." AS tomschrijving, a.tip_specialist".$vars["ttv"]." AS tip_specialist, t.tip_specialist".$vars["ttv"]." AS ttip_specialist, a.praktische_info".$vars["ttv"]." AS praktische_info, t.praktische_info".$vars["ttv"]." AS tpraktische_info, a.kwaliteit AS akwaliteit, a.kenmerken AS kenmerken_accommodatie, t.type_id, t.kwaliteit, t.optimaalaantalpersonen, a.toonper, a.aantekeningen, t.aantekeningen AS taantekeningen, t.kenmerken AS kenmerken_type, t.maxaantalpersonen, t.oppervlakte, t.oppervlakteextra".$vars["ttv"]." AS oppervlakteextra, t.slaapkamers, t.slaapkamersextra".$vars["ttv"]." AS slaapkamersextra, t.badkamers, t.badkamersextra".$vars["ttv"]." AS badkamersextra, a.indeling".$vars["ttv"]." AS indeling, t.indeling".$vars["ttv"]." AS tindeling, a.afstandwinkel, a.afstandwinkelextra".$vars["ttv"]." AS afstandwinkelextra, a.afstandrestaurant, a.afstandrestaurantextra".$vars["ttv"]." AS afstandrestaurantextra, a.afstandpiste, a.afstandpisteextra".$vars["ttv"]." AS afstandpisteextra, a.afstandskilift, a.afstandskiliftextra".$vars["ttv"]." AS afstandskiliftextra, a.afstandloipe, a.afstandloipeextra".$vars["ttv"]." AS afstandloipeextra, a.afstandskibushalte, a.afstandskibushalteextra".$vars["ttv"]." AS afstandskibushalteextra, p.afstandtotutrecht, a.afstandstrand, a.afstandstrandextra".$vars["ttv"]." AS afstandstrandextra, a.afstandzwembad, a.afstandzwembadextra".$vars["ttv"]." AS afstandzwembadextra, a.afstandzwemwater, a.afstandzwemwaterextra".$vars["ttv"]." AS afstandzwemwaterextra, a.afstandgolfbaan, a.afstandgolfbaanextra".$vars["ttv"]." AS afstandgolfbaanextra, p.bekendestad".$vars["ttv"]." AS bekendestad, p.afstandbekendestad, p.afstandbekendestadextra".$vars["ttv"]." AS afstandbekendestadextra, a.inclusief".$vars["ttv"]." AS inclusief, a.gps_lat, a.gps_long, t.gps_lat AS tgps_lat, t.gps_long AS tgps_long, t.inclusief".$vars["ttv"]." AS tinclusief, a.exclusief".$vars["ttv"]." AS exclusief, a.extraopties".$vars["ttv"]." AS extraopties, t.exclusief".$vars["ttv"]." AS texclusief, t.url_virtuele_rondgang, a.video AS avideo, a.video_url AS avideo_url, t.video AS tvideo, t.video_url AS tvideo_url, l.naam".$vars["ttv"]." AS land, l.begincode, p.naam".$vars["ttv"]." AS plaats, p.omschrijving".$vars["ttv"]." AS plaatsomschrijving, p.plaats_id, p.kenmerken AS kenmerken_plaats, s.naam".$vars["ttv"]." AS skigebied, s.omschrijving".$vars["ttv"]." AS skigebiedomschrijving, s.kenmerken AS kenmerken_skigebied, lev.leverancier_id, lev.naam AS leverancier, lev.opmerkingen_intern AS lopmerkingen_intern, lev.url AS url_leverancier, lev.contactpersoon_contract AS contactpersoon_contract_leverancier, lev.email_contract AS email_contract_leverancier, lev.contactpersoon_reserveringen AS contactpersoon_reserveringen_leverancier, lev.email_reserveringen AS email_reserveringen_leverancier FROM accommodatie a, plaats p, skigebied s, land l, type t, leverancier lev WHERE a.accommodatie_id=t.accommodatie_id AND p.land_id=l.land_id AND t.type_id='".addslashes($typeid)."' AND a.plaats_id=p.plaats_id AND p.skigebied_id=s.skigebied_id AND a.tonen=1 AND t.websites LIKE '%".$vars["website"]."%' AND t.leverancier_id=lev.leverancier_id AND t.tonen=1;");
if($db->next_record()) {
	$accid=$db->f("accommodatie_id");

	echo "<div id=\"toonaccommodatie_content\" itemscope=\"itemscope\" itemtype=\"http://schema.org/LodgingBusiness\">";
	echo "<div id=\"toonaccommodatie_bovenbalk\">";
	echo "<div id=\"toonaccommodatie_foto\">";
	if(($vars["seizoentype"]==1 or $vars["seizoentype"]==2) and $vars["websitetype"]<>6) {
		# telefoonblok
		if($vars["website"]<>"T" and (!$vars["verberg_linkerkolom"] or $id=="toonaccommodatie")) {
			echo "<div id=\"telefoonblok\" class=\"noprint".($id<>"contact" ? " telefoonblokhover" : "")."\"".($id<>"contact" ? " onclick=\"document.location.href='".$vars["path"].txt("menu_contact").".php';\"" : "")." style=\"\">";
			echo "<div id=\"telefoonblok_nummer\"><table class=\"table\"><tr><td><img src=\"".$vars["path"]."pic/icon_telefoon_";
			if($vars["websitetype"]==7) {
				echo "italissima";
			} elseif($vars["websitetype"]==8) {
				echo "superski";
			} elseif($vars["websitetype"]==9) {
				echo "venturasol";
			} elseif($vars["seizoentype"]==2) {
				echo "zomer";
			} else {
				echo "winter";
			}
			echo ".gif\"></td><td>".html("telefoonnummer_telefoonblok")."</td></tr></table></div>";
			echo "<div id=\"telefoonblok_open\">".html("openingstijden_telefoonblok")."</div>";
			echo "</div>"; # afsluiten telefoonblok


			if($vars["livechat_code"] and preg_match("@^([0-9])-(.*)$@",$vars["livechat_code"],$regs)) {

				#
				# Chatsysteem
				#

				# chatblok
				echo "<div id=\"chatblok\" class=\"noprint\">";
				echo "<div data-id=\"".wt_he($regs[2])."\" class=\"livechat_button\"><a href=\"http://www.livechatinc.com/\">live chat software</a></div>";
				echo "</div>"; # afsluiten chatblok
			}


		}
		if($vars["websitetype"]==3) {
			# Zomerhuisje
		} elseif($vars["websitetype"]==7) {
			# Italissima
			echo "<div style=\"margin-top: 30px;\"></div>";
		} else {
			# de rest
			echo "<div style=\"margin-top: 40px;\"></div>";
		}
	}
	echo "<div style=\"clear: both;\"></div>\n";

    $mongodb      = $vars['mongodb']['wrapper'];
    $cursors      = [];
    $files        = ['a' => null, 't' => null, 'always' => false, 'all' => ['pic' => [], 'picbreed' => [], 'piconderaan' => []]];
    $cursors['a'] = $mongodb->getAllFiles('accommodations', [(int)$accid]);
    $cursors['t'] = $mongodb->getAllFiles('types', [(int)$typeid]);
    $done         = false;

    foreach ($cursors['a'] as $file) {

        if (isset($file['type']) && $file['type'] === 'big') {

            $files['a']		 = $file['directory'] . '/' . $file['filename'];
			$files['always'] = isset($file['always']) && true === boolval($file['always']);
        }

        if (preg_match('/_breed/', $file['kind'])) {

            $done = true;
            $files['all']['picbreed'][] = $file['directory'] . '/' . $file['filename'];
        }

        if (isset($file['under']) && true === $file['under']) {

            $done = true;
            $files['all']['piconderaan'][] = $file['directory'] . '/' . $file['filename'];
        }

        if (false === $done) {
            $files['all']['pic'][] = $file['directory'] . '/' . $file['filename'];
        }

        $done = false;
    }

    foreach ($cursors['t'] as $file) {

        if (isset($file['type']) && $file['type'] === 'big') {

            $files['t']		 = $file['directory'] . '/' . $file['filename'];
			$files['always'] = isset($file['always']) && true === boolval($file['always']);
        }

        if (preg_match('/_breed/', $file['kind'])) {
            $files['all']['picbreed'][] = $file['directory'] . '/' . $file['filename'];
        } else {
            $files['all']['pic'][] = $file['directory'] . '/' . $file['filename'];
        }
    }

    $files['all']['pic'] = array_merge($files['all']['pic'], $files['all']['piconderaan']);

    if (null !== $files['t']) {
        $afbeelding = $files['t'];
    } elseif (null !== $files['a']) {
        $afbeelding = $files['a'];
    } else {
        $afbeelding = 'accommodaties/0.jpg';
    }

	echo "<img src=\"".imageurl($afbeelding,170,127)."\" itemprop=\"image\" alt=\"".wt_he(ucfirst($vars["soortaccommodatie"][$db->f("soortaccommodatie")])." ".$db->f("naam").($db->f("tnaam") ? " ".$db->f("tnaam") : ""))."\" width=\"170\" height=\"127\" style=\"".($afbeeldingborder ? "border: 1px solid #000000;" : "")."\">";
	echo "</div>";
	echo "<div id=\"toonaccommodatie_kopteksten\">";
	if( $aanbieding_actief ) {
		echo "<a href=\"#prijsinformatie\" id=\"toonaccommodatie_aanbieding\" title=\"".html("bekijkdeaanbieding","toonaccommodatie")."\"><img src=\"".$vars["path"]."pic/aanbieding_groot_".$vars["websitetype"].".gif\">".html("aanbieding_klein","toonaccommodatie")."</a>";
	}
	if( $accinfo["toonper"]==1 and !$vars["wederverkoop"] ) {
		echo "<div class=\"toonaccommodatie_skipas".( $aanbieding_actief ? " toonaccommodatie_skipas_en_aanbieding" : "")."\" title=\"".html("inclusiefskipas","toonaccommodatie")."\">".html("incl-skipas","accommodaties")."</div>";
	}

	if($accinfo["bestelnaam"] and $voorkant_cms) echo "<i>(".wt_he($accinfo["bestelnaam"]).")</i><br>";
	echo "<h1 itemprop=\"name\">".wt_he(ucfirst($vars["soortaccommodatie"][$db->f("soortaccommodatie")])." ".$db->f("naam"))."</h1>";
	echo "<h3 style=\"padding-bottom:3px;\">".($db->f("tnaam") ? wt_he($db->f("tnaam")) : "&nbsp;")."</h3>";
	if($vars["websitetype"]==6) {
		echo "<div id=\"toonaccommodatie_vallandry_spacer\">&nbsp;</div>";
	} else {
		echo "<div class=\"invisible_link\"><a href=\"".$path.txt("canonical_accommodatiepagina")."/".txt("menu_plaats")."/".wt_convert2url_seo($db->f("plaats"))."/#beschrijving\">".wt_he($db->f("plaats"))."</a> - <a href=\"".$path.txt("canonical_accommodatiepagina")."/".txt("menu_skigebied")."/".wt_convert2url_seo($db->f("skigebied"))."/#beschrijving\">".wt_he($db->f("skigebied"))."</a></div>";
	}
	echo "<div id=\"toonaccommodatie_kenmerken\">";
	echo "<div id=\"toonaccommodatie_kenmerken_1\">";
	echo "<ul>";
	# Aantal personen
	echo "<li>".$db->f("optimaalaantalpersonen").($db->f("maxaantalpersonen")>$db->f("optimaalaantalpersonen") ? " - ".$db->f("maxaantalpersonen") : "")." ";
	if($db->f("maxaantalpersonen")==1) {
		echo html("persoon");
	} else {
		echo html("personen");
	}
	echo "</li>";
	# Aantal slaapkamers
	if($db->f("slaapkamers")) {
		echo "<li>";
		echo $db->f("slaapkamers")." ";
		if($db->f("slaapkamers")==1) {
			echo html("slaapkamer");
		} else {
			echo html("slaapkamers");
		}
		if($db->f("slaapkamersextra")) {
			echo " (".wt_he($db->f("slaapkamersextra")).")";
		}
		echo "</li>";
	}
	# Aantal badkamers
	if($db->f("badkamers")) {
		echo "<li>";
		echo $db->f("badkamers")." ";
		if($db->f("badkamers")==1) {
			echo html("badkamer");
		} else {
			echo html("badkamers");
		}
		if($db->f("badkamersextra")) {
			echo " (".wt_he($db->f("badkamersextra")).")";
		}
		echo "</li>";
	}
	echo "</ul>";
	echo "</div>";
	echo "<div id=\"toonaccommodatie_kenmerken_2\">";
	echo "<ul>";
	if($db->f("oppervlakte")) {
		echo "<li>".$db->f("oppervlakte")." m&#178;".($db->f("oppervlakteextra") ? " - ".wt_he($db->f("oppervlakteextra")) : "")."</li>";
	} else {
		echo "<div style=\"height:2px;\"></div>";
	}

	if($db->f("akwaliteit") or $db->f("kwaliteit")) {

		$kwaliteit = ($db->f('kwaliteit') ?: $db->f('akwaliteit'));
		echo "<li><a href=\"".$vars["path"]."popup_fancybox.php?popupfbid=kwaliteit\" class=\"popup_fancybox\" rel=\"nofollow\" id=\"toonaccommodatie_kenmerken_klassering\">";
		echo "<div style=\"float:left;margin-right:4px;\">".html("klassering","toonaccommodatie").":</div>";
		for ($i = 1; $i <= 5; $i++) {
			echo '<img src="' . $vars['path'] . 'pic/ster_' . ($i > $kwaliteit ? 'leeg_' : '') . $vars['websitetype'] . '.png" width="17" height="16" border="0">';
		}

		echo "<img src=\"".$vars["path"]."pic/class.form_info_icon.gif\" id=\"toonaccommodatie_kenmerken_klassering_info\" width=\"13\" height=\"13\" border=\"0\" style=\"margin-top:1px;margin-bottom:-1px;\">";

		echo "<div class=\"clear\"></div>";
		echo "</a>"; # afsluiten toonaccommodatie_kenmerken_klassering
		echo "</li>";
	}

	// beoordeling tonen
	if($vars["websitetype"]==1 or $vars["websitetype"]==4 or $vars["websitetype"]==6 or $vars["websitetype"]==7 or $vars["websitetype"]==8) {


		if($vars["websitetype"]==7) {
			// Italissima: combine reviews from other types of the same accommodation
			$db2->query("SELECT AVG(be.vraag1_7) AS totaaloordeel, COUNT(be.type_id) AS aantal FROM boeking_enquete be, type t WHERE t.accommodatie_id='".intval($db->f("accommodatie_id"))."' AND be.type_id=t.type_id AND be.vraag1_7>0 AND be.beoordeeld=1 GROUP BY t.accommodatie_id;");
		} else {
			// Other sites: only show reviews from this type
			$db2->query("SELECT AVG(vraag1_7) AS totaaloordeel, COUNT(type_id) AS aantal FROM boeking_enquete WHERE type_id='".addslashes($typeid)."' AND vraag1_7>0 AND beoordeeld=1 GROUP BY type_id;");
		}
		if($db2->next_record()) {
			$review["counter"] += $db2->f("aantal");
			$review["counter_enquete"] = $db2->f("aantal");
			$review["totaaloordeel"] = $db2->f("totaaloordeel");
		}

		if($review["counter"] && $review['counter'] > 1) {
			# Bij een 10: alleen tonen als er meer dan 1 beoordeling is
			echo "<li><div style=\"float:left;\">" . html("waardering","toonaccommodatie") . " </div>";
			if($review["totaaloordeel"]>=1) {
				echo "<div id=\"toonaccommodatie_kenmerken_2_beoordeling\">";
				if($review["totaaloordeel"]==10) {
					echo "10";
				} else {
					echo number_format($review["totaaloordeel"],1,",",".");
				}
				echo "</div>";
				$review_between_brackets = true;
			}
			echo "<div id=\"toonaccommodatie_kenmerken_2_beoordelinglink\">";
			if($review_between_brackets) echo "(";
			echo "<a href=\"".$vars["path"]."popup_fancybox.php?popupfbid=beoordelingen&typeid=".$typeid."\" rel=\"nofollow\" id=\"beoordeling_link\">".$review["counter"]." ".($review["counter"]==1 ? html("klantbeoordeling","toonaccommodatie") : html("klantbeoordelingen","toonaccommodatie"))."</a>";
			if($review_between_brackets) echo ")";
			echo "</div>";

			// rich snippet rating
			if($review["counter_enquete"]>0 and $review["totaaloordeel"]>=1 and $review["totaaloordeel"]<=10) {
				echo "<div id=\"rich_snippets_rating\" itemprop=\"aggregateRating\" itemscope itemtype=\"http://schema.org/AggregateRating\"><span itemprop=\"ratingValue\">".number_format($review["totaaloordeel"],1,".",".")."</span><span itemprop=\"bestRating\">10</span><span itemprop=\"ratingCount\">".$review["counter_enquete"]."</span></div>";
			}

			echo "<div class=\"clear\"></div></li>";
		}
	}
	echo "</ul>";
	echo "</div>";
	echo "<div style=\"clear: both;\"></div>\n";
	echo "</div>";
	echo "</div>";
	echo "<div style=\"clear: both;height:2px;\"></div>\n";

	# a name om naartoe te scrollen (net boven de tabs)
	echo "<div id=\"scroll_to_tabs\"></div>";

	# Video
	if($db->f("avideo") or $db->f("tvideo")) {
		if($db->f("tvideo") and $db->f("tvideo_url")) {
			$video_url=$db->f("tvideo_url");
		} elseif($db->f("avideo") and $db->f("avideo_url")) {
			$video_url=$db->f("avideo_url");
		}
		if($video_url) {
			if(preg_match("/vimeo\.com/",$video_url) and !preg_match("/\?/",$video_url)) {
				$video_url.="?autoplay=1";
			}
		}
	}


	# Tabs
	echo "<div id=\"tabs\">";
	echo "<ul class=\"noprint\">";
	echo "<li><a href=\"#overzicht\">".html("tab_overzicht","toonaccommodatie")."</a></li>";
	echo "<li><a href=\"#indeling\">".html("tab_indeling","toonaccommodatie")."</a></li>";
	if($video_url) {
		echo "<li><a href=\"#fotos\">".html("tab_fotos_videos","toonaccommodatie")."</a></li>";
	} else {
		echo "<li><a href=\"#fotos\">".html("tab_fotos","toonaccommodatie")."</a></li>";
	}
	echo "<li><a href=\"#ligging\">".html("tab_ligging","toonaccommodatie")."</a></li>";
	echo "<li><a href=\"#extraopties\">".html("tab_opties","toonaccommodatie")."</a></li>";
	echo "<li><a href=\"#prijsinformatie\">".html("tab_tarieven","toonaccommodatie")."</a></li>";
	echo "</ul>";
	# Tab "overzicht"
	echo "<div id=\"overzicht\">";
	# Interne gegevens tonen
	if($voorkant_cms) {
		unset($temp_intern);
		$temp_intern.="<table width=\"660\" border=\"0\" class=\"toonacctabel\" cellspacing=\"0\">";
		$temp_intern.="<tr><th colspan=\"2\">Interne gegevens (alleen zichtbaar voor Chalet.nl)</th></tr>";
		$temp_intern.="<tr><td valign=\"top\" width=\"175\" nowrap class=\"leftcell\">Code</TD><TD class=\"rightcell\">".wt_he($db->f("begincode").$db->f("type_id")).($db->f("code") ? " - ".wt_he($db->f("code")) : "").($db->f("verzameltype") ? " - verzameltype" : "")."</TD></TR>";
		$temp_intern.="<tr><td valign=\"top\" width=\"175\" nowrap class=\"leftcell\">Lev.</TD><TD class=\"rightcell\"><a href=\"".$vars["cmspath"]."cms_leveranciers.php?show=8&beheerder=0&8k0=".$db->f("leverancier_id")."\" target=\"_blank\">".wt_he($db->f("leverancier"))."</a>";

		$lev_mailto = [

			'reserveringen' => [

				'contact' => $db->f('contactpersoon_reserveringen_leverancier'),
				'email'   => $db->f('email_reserveringen_leverancier'),
			],

			'contract' => [

				'contact' => $db->f('contactpersoon_contract_leverancier'),
				'email'   => $db->f('email_contract_leverancier')
			],
		];

		$temp_intern   .= '<a href="mailto:?body=';
		$newline_mailto = '%0D%0A';

		if ($lev_mailto['reserveringen']['contact'] != '' || $lev_mailto['reserveringen']['email'] != '') {

			$temp_intern .= 'Reserveringen' . $newline_mailto;
			$temp_intern .= $lev_mailto['reserveringen']['contact'] . ($lev_mailto['reserveringen']['contact'] != '' ? $newline_mailto : '');
			$temp_intern .= $lev_mailto['reserveringen']['email'] . $newline_mailto . $newline_mailto;
		}

		if ($lev_mailto['contract']['contact'] != '' || $lev_mailto['contract']['email'] != '') {

			$temp_intern .= 'Contract' . $newline_mailto;
			$temp_intern .= $lev_mailto['contract']['contact'] . ($lev_mailto['contract']['contact'] != '' ? $newline_mailto : '');
			$temp_intern .= $lev_mailto['contract']['email'];
		}

		$temp_intern .= '" style="float:right;"><img src="' . $vars['path'] . 'pic/icon_email.gif" /></a>';

		if($db->f("url_leverancier")) {
			$temp_intern.="<br><br>&bull;&nbsp;&nbsp;<a href=\"".wt_he($db->f("url_leverancier"))."\" target=\"_blank\">Website leverancier</a>";
		}
		if($db->f("aurl_leverancier")) {
			$temp_intern.="<br><br>&bull;&nbsp;&nbsp;<a href=\"".wt_he($db->f("aurl_leverancier"))."\" target=\"_blank\">Directe link accommodatie</a>";
		}
		if($db->f("turl_leverancier")) {
			$temp_intern.="<br><br>&bull;&nbsp;&nbsp;<a href=\"".wt_he($db->f("turl_leverancier"))."\" target=\"_blank\">Directe link type</a>";
		}
		$temp_intern.="</TD></TR>";
		if($db->f("lopmerkingen_intern")) {
			$temp_intern.="<tr><td valign=\"top\" width=\"175\" nowrap class=\"leftcell\">Opm.</TD><TD class=\"rightcell\"><div class=\"rightcelldiv\">".tooninterneopmerkingen($db->f("lopmerkingen_intern"))."</div></TD></TR>";
		}
		if($db->f("aantekeningen")) {
			$temp_intern.="<tr><td valign=\"top\" width=\"175\" nowrap class=\"leftcell\">Acc.</TD><TD class=\"rightcell\"><div class=\"rightcelldiv\">".tooninterneopmerkingen($db->f("aantekeningen"))."</div></TD></TR>";
		}
		if($db->f("taantekeningen")) {
			$temp_intern.="<tr><td valign=\"top\" width=\"175\" nowrap class=\"leftcell\">Type</TD><TD class=\"rightcell\"><div class=\"rightcelldiv\">".tooninterneopmerkingen($db->f("taantekeningen"))."</div></TD></TR>";
		}
		$temp_intern.="<tr><td valign=\"top\" width=\"175\" nowrap class=\"leftcell\">Kenmerken</TD><TD class=\"rightcell\"><div class=\"rightcelldiv\">".($db->f("kenmerken_gecontroleerd") ? "gecontroleerd" : "niet gecontroleerd")."</div></TD></TR>";
		#
		# Kenmerken
		#
		$doorloop_array=array("kenmerken_accommodatie"=>"Acc-kenm.","kenmerken_type"=>"Type-kenm.","kenmerken_plaats"=>"Plaats-kenm.","kenmerken_skigebied"=>"Regio-kenm.");
		while(list($key,$value)=each($doorloop_array)) {
			if($db->f($key)) {
				$temp_intern.="<tr><td valign=\"top\" width=\"175\" nowrap class=\"leftcell\">".ereg_replace("-","-<br>",wt_he($value))."</TD><TD class=\"rightcell\">";
				$kenmerken=split(",",$db->f($key));
				reset($vars[$key."_".$vars["seizoentype"]]);
				while(list($key2,$value2)=each($vars[$key."_".$vars["seizoentype"]])) {
					if(in_array($key2,$kenmerken)) $temp_intern.=wt_he($value2)."<br>";
				}
				$temp_intern.="</td></tr>";
			}
		}
		#
		# Enquête
		#
		$db2->query("SELECT b.boeking_id, b.aankomstdatum_exact, be.beoordeeld, be.vraag1_1, be.vraag1_2, be.vraag1_3, be.vraag1_4, be.vraag1_5, be.vraag1_6, be.vraag1_7 FROM boeking_enquete be, boeking b, type t WHERE b.type_id=t.type_id AND be.boeking_id=b.boeking_id AND t.type_id='".addslashes($typeid)."' ORDER BY b.aankomstdatum_exact DESC, b.boeking_id;");
		if($db2->num_rows()) {
			while($db2->next_record()) {
				for($i=1;$i<=7;$i++) {
					if($db2->f("vraag1_".$i) and $db2->f("vraag1_".$i)<=10) {
						$enquete_optellen[$i]+=$db2->f("vraag1_".$i);
						$enquete_teller[$i]++;
					}
				}
				$complete_enquete[$db2->f("boeking_id")]="<a href=\"".$vars["cms_basehref"]."cms_boekingen_enquete.php?bid=".$db2->f("boeking_id")."&controleren=1\" target=\"_blank\">".date("d-m-Y",$db2->f("aankomstdatum_exact"))."</a>".($db2->f("vraag1_7") ? " (totaaloordeel: ".$db2->f("vraag1_7").")" : "");
				if($db2->f("beoordeeld")==0) {
					$complete_enquete[$db2->f("boeking_id")].=" <a href=\"".$vars["cms_basehref"]."cms_boekingen_enquete.php?bid=".$db2->f("boeking_id")."&controleren=1\" target=\"_blank\">controleren</a>";
				} elseif($db2->f("beoordeeld")==2 and ($login->user_id==4 or $login->user_id==6)) {
					$complete_enquete[$db2->f("boeking_id")].=" <a href=\"".$vars["cms_basehref"]."cms_boekingen_enquete.php?bid=".$db2->f("boeking_id")."&controleren=1\" title=\"Controleren door Bert of Barteld\" target=\"_blank\">controleren B/B</a>";
				} elseif($db2->f("beoordeeld")==2) {
					$complete_enquete[$db2->f("boeking_id")].=" <span title=\"Controleren door Bert of Barteld\" style=\"border-bottom: 1px dotted #000000;\">controleren B/B</span>";
				} elseif($db2->f("beoordeeld")==3) {
					$complete_enquete[$db2->f("boeking_id")].=" <span style=\"color:red;\">afgekeurd</span>";
				}
			}
			$temp_intern.="<tr><td valign=\"top\" width=\"175\" nowrap class=\"leftcell\">Enqu&ecirc;tes<br>(gemiddeld)</TD><TD class=\"rightcell\"><div class=\"rightcelldiv\">";
			$temp_intern.="<table cellspacing=\"0\" cellpadding=\"0\">";
			$temp_intern.="<tr><td>Totaaloordeel&nbsp;</td><td>".($enquete_teller[7] ? number_format(($enquete_optellen[7]/$enquete_teller[7]),1,",",".") : "&nbsp;")."</td></tr>";
			$temp_intern.="<tr><td>Ontvangst&nbsp;</td><td>".($enquete_teller[1] ? number_format(($enquete_optellen[1]/$enquete_teller[1]),1,",",".") : "&nbsp;")."</td></tr>";
			$temp_intern.="<tr><td>Ligging&nbsp;</td><td>".($enquete_teller[2] ? number_format(($enquete_optellen[2]/$enquete_teller[2]),1,",",".") : "&nbsp;")."</td></tr>";
			$temp_intern.="<tr><td>Comfort/inrichting&nbsp;</td><td>".($enquete_teller[3] ? number_format(($enquete_optellen[3]/$enquete_teller[3]),1,",",".") : "&nbsp;")."</td></tr>";
			$temp_intern.="<tr><td>Hygi&euml;ne/schoonmaak&nbsp;</td><td>".($enquete_teller[4] ? number_format(($enquete_optellen[4]/$enquete_teller[4]),1,",",".") : "&nbsp;")."</td></tr>";
			$temp_intern.="<tr><td>Faciliteiten&nbsp;</td><td>".($enquete_teller[5] ? number_format(($enquete_optellen[5]/$enquete_teller[5]),1,",",".") : "&nbsp;")."</td></tr>";
			$temp_intern.="<tr><td>Prijs/kwaliteit&nbsp;</td><td>".($enquete_teller[6] ? number_format(($enquete_optellen[6]/$enquete_teller[6]),1,",",".") : "&nbsp;")."</td></tr>";
			$temp_intern.="</table>";
			$temp_intern.="</div></TD></TR>";
			$temp_intern.="<tr><td valign=\"top\" width=\"175\" nowrap class=\"leftcell\">Enqu&ecirc;tes<br>(volledig)</TD><TD class=\"rightcell\"><div class=\"rightcelldiv\">";
			while(list($key,$value)=each($complete_enquete)) {
				$temp_intern.="<div style=\"white-space:nowrap;\">&bull;&nbsp;".$value."</div>";
			}
			$temp_intern.="</div></TD></TR>";
		}
		#
		# Rechtstreekse links naar tabs
		#
		if($vars["taal"]=="nl") {
			$temp_intern.="<tr><td valign=\"top\" colspan=\"2\" nowrap><i>Links naar tabs:</i><br><br>";
#			$temp_intern.="<a href=\"".wt_he($accinfo["url"]."#overzicht")."\" target=\"_blank\">".wt_he($accinfo["url"]."#overzicht")."</a><br>";
			$temp_intern.="<a href=\"".wt_he($accinfo["url"]."#indeling")."\" target=\"_blank\">".wt_he($accinfo["url"]."#indeling")."</a><br>";
			$temp_intern.="<a href=\"".wt_he($accinfo["url"]."#fotos")."\" target=\"_blank\">".wt_he($accinfo["url"]."#fotos")."</a><br>";
			$temp_intern.="<a href=\"".wt_he($accinfo["url"]."#ligging")."\" target=\"_blank\">".wt_he($accinfo["url"]."#ligging")."</a><br>";
			$temp_intern.="<a href=\"".wt_he($accinfo["url"]."#extraopties")."\" target=\"_blank\">".wt_he($accinfo["url"]."#extraopties")."</a><br>";
			$temp_intern.="<a href=\"".wt_he($accinfo["url"]."#prijsinformatie")."\" target=\"_blank\">".wt_he($accinfo["url"]."#prijsinformatie")."</a><br>";
			$temp_intern.="</TD></TR>";
		}
		$temp_intern.="</table><p>";
#		echo $temp_intern;
#		if($db->f("type_id")==1542) {
			$interneinfo .= $temp_intern;
#		}
	}

    $fototeller = 0;
	if(count($files['all']['pic']) > 0) {

		echo "<div id=\"toonaccommodatie_overzicht_fotos\" class=\"noprint\">";
		echo "<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\"><tr>";

		if($video_url) {

			$fototeller++;
			echo "<td rowspan=\"2\">";
			echo "<a href=\"".wt_he($video_url)."\" class=\"vimeo_fancybox\">";
			echo "<img src=\"".$vars['path']."pic/video-preview_".$vars["seizoentype"].".jpg\" width=\"175\" height=\"127\" border=\"0\">";
			echo "</a></td>";
		}

		foreach ($files['all']['pic'] as $file) {

            $currentImage = $file;

            if ($currentImage === $afbeelding && false === $files['always']) {
                continue;
            }

			$fototeller++;
			if($fototeller > 3) {
                break;
            }

			echo "<td rowspan=\"2\">";
			echo "<a href=\"#\" class=\"fotopopup_tab_overzicht\" data-teller=\"".$fototeller."\">";
			echo "<img src=\"".imageurl($currentImage, 170, 127)."\" width=\"170\" height=\"127\" alt=\"".wt_he(ucfirst($vars["soortaccommodatie"][$db->f("soortaccommodatie")])." ".$db->f("naam").($db->f("tnaam") ? " ".$db->f("tnaam") : "")." - ".txt("foto","vars")." ".$fototeller)."\" border=\"0\">";
			echo "</a>";
			echo "</td>";
		}
		# Afbeelding "bekijk ligging" plaatsen
		if(($db->f("gps_lat")<>"" and $db->f("gps_long")<>"") or ($db->f("tgps_lat")<>"" and $db->f("tgps_long")<>"")) {
			echo "<td valign=\"top\">";
			echo "<a href=\"#ligging\"><img src=\"".$vars["path"]."pic/bekijkligging-".strtolower($vars["website"]).".png\" border=\"0\" width=\"150\" height=\"100\" title=\"Google Maps\"></a>";
			echo "</td></tr>";
		} else {
			echo "<td>&nbsp;</td></tr>";
		}
		echo "<tr><td valign=\"bottom\">";
		if (count($files['all']['pic']) > 3) {
			echo "<a href=\"#fotos\" class=\"noprint\">".html("meerfotos","toonaccommodatie")." &gt;</a>";
		} else {
			echo "&nbsp;";
		}
		echo "</td></tr></table>";
		echo "</div>";
	}

	//
	// show facilities / kenmerken
	//
	$kenmerken = new kenmerken();
	$toon_kenmerken = $kenmerken->get_kenmerken($typeid,
			array(
				"type"=>$db->f( "kenmerken_type" ),
				"accommodatie"=>$db->f( "kenmerken_accommodatie" ),
				"plaats"=>$db->f( "kenmerken_plaats" ),
				"skigebied"=>$db->f( "kenmerken_skigebied" ),
				"toonper"=>$db->f( "toonper" ),
			));

	if(is_array($toon_kenmerken)) {

		setlocale(LC_COLLATE, "nl_NL.ISO8859-1");
		ksort($toon_kenmerken, SORT_LOCALE_STRING);
		setlocale(LC_COLLATE, "C");

		foreach ($toon_kenmerken as $key => $value) {
			if( $txt[$vars["taal"]]["kenmerken"][$key] ) {
				$kenmerken_array[] = txt($key, "kenmerken");
			}
		}
	}

	if ($db->f( "flexibel" )) {
		$kenmerken_array[] = txt("fleixibele-aankomst-vertrek", "toonaccommodatie");
	}

	if (is_array($kenmerken_array)) {
		echo AccPageShowCharacteristics::show($kenmerken_array);
	}

	if($db->f("korteomschrijving") or $db->f("tkorteomschrijving")) {
		echo "<h2>";
		if($db->f("tkorteomschrijving")) {
			echo wt_he($db->f("tkorteomschrijving"));
			$omschrijving = wt_he($db->f("tkorteomschrijving"));
		} else {
			echo wt_he($db->f("korteomschrijving"));
			$omschrijving = wt_he($db->f("korteomschrijving"));
		}
		echo "</h2>";
	}

	// omschrijving
	if($db->f("omschrijving") or $db->f("tomschrijving")) {
		echo "<div style=\"margin-top:10px;\">".toon_tekst_acc_en_type($db->f("omschrijving"), $db->f("tomschrijving"))."</div>";
	}

	// tip van de specialist
	if($db->f("tip_specialist") or $db->f("ttip_specialist")) {
		echo "<div style=\"margin-top:15px;\">";
		echo "<h3 class=\"minder_opvallend\">".html("tip-van-de-specialist", "toonaccommodatie")."</h3>";
		echo toon_tekst_acc_en_type($db->f("tip_specialist"), $db->f("ttip_specialist"), " ");
		echo "</div>";
	}

	// praktische info
	if($db->f("praktische_info") or $db->f("tpraktische_info")) {
		echo "<div style=\"margin-top:15px;\">";
		echo "<h3 class=\"minder_opvallend\">".html("praktische-informatie", "toonaccommodatie")."</h3>";
		echo toon_tekst_acc_en_type($db->f("praktische_info"), $db->f("tpraktische_info"), " ");
		echo "</div>";
	}



	// ligging
	$ligging        = '';
	$liggingCounter = 4;
	$liggingHtml    = function($label, $distance, $extra) {
	    return $label . ': ' . wt_he(distance::show($distance, $extra));
	};

	if ($db->f('afstandwinkel') || $db->f('afstandwinkel') == '0') {

	    $ligging .= $liggingHtml(html('afstandtotwinkels', 'toonaccommodatie'), $db->f('afstandwinkel'), $db->f('afstandwinkelextra')) . '<br />';
	    $liggingCounter -= 1;
	}

	if ($db->f('afstandrestaurant') || $db->f('afstandrestaurant') == '0') {

		$ligging .= $liggingHtml(html('afstandrestaurantbar', 'toonaccommodatie'), $db->f('afstandrestaurant'), $db->f('afstandrestaurantextra')) . '<br />';
		$liggingCounter -= 1;
	}

	if ($db->f('afstandstrand') || $db->f('afstandstrand') == '0') {

	    $ligging .= $liggingHtml(html('afstandstrand', 'toonaccommodatie'), $db->f('afstandstrand'), $db->f('afstandstrandextra')) . '<br />';
	    $liggingCounter -= 1;
	}

	if ($db->f('afstandbekendestad') && $db->f('bekendestad')) {

		$ligging .= $liggingHtml(html('afstandbekendestad', 'toonaccommodatie', ['v_stad' => $db->f('bekendestad')]), $db->f('afstandbekendestad') * 1000, $db->f('afstandbekendestadextra')) . '<br />';
		$liggingCounter -= 1;
	}

	$extraDistancesHtml = [];

	if ($liggingCounter > 0) {

		$extraDistances     = new ExtraDistances(new ExtraDistancesRepository(new DB_Sql(), $vars['taal']));
		$distances          = $extraDistances->all($db->f('accommodatie_id'));

		foreach ($distances as $distance) {

			$extraDistancesHtml[] = '<tr><td width="175" nowrap>' . txt('afstandtot', 'toonaccommodatie') . ' ' . $distance['name'] . '</td><td>' . wt_he(distance::show($distance['distance'], $distance['addition']));

			if ($liggingCounter > 0) {

				$ligging             .= $liggingHtml(txt('afstandtot', 'toonaccommodatie') . ' ' . $distance['name'], $distance['distance'], $distance['addition']) . '<br />';
				$liggingCounter      -= 1;
			}
		}
	}

	if (!empty($ligging) && $vars['website'] === 'I') {

		$liggingHtml  = '<div style="margin-top: 15px;">';
		$liggingHtml .= '<h3 class="minder_opvallend">' . html('ligging', 'toonaccommodatie') . '</h3>';
		$liggingHtml .= $ligging;
		$liggingHtml .= '</div>';

		echo $liggingHtml;
	}

	echo "</div>";

	#
	# Tab "indeling"
	#
	echo "<div id=\"indeling\">";
	echo "<div class=\"onlyprint\"><br>&nbsp;<br><h3>".html("indeling","toonaccommodatie")."</h3></div>";

	if($db->f("indeling") or $db->f("tindeling")) {
		echo toon_tekst_acc_en_type($db->f("indeling"),$db->f("tindeling"));
	}
	echo "</div><!-- afsluiten_tabs_indeling -->";

	#
	# Tab "foto's"
	#
	echo "<div id=\"fotos\">";
	echo "<div class=\"onlyprint\"><br>&nbsp;<br><h3>".html("fotos","vars")."</h3></div>";
	if($db->f("url_virtuele_rondgang")) {
		echo "<div style=\"padding-bottom:5px;\">";
		echo "<a href=\"".wt_he($db->f("url_virtuele_rondgang"))."\" target=\"_blank\">";
		echo html("virtuele_rondgang_acc","toonaccommodatie");
		echo " &gt;</a>";
		echo "</div>";
	}
#	imagetable(array("accommodaties_aanvullend","types","accommodaties_aanvullend_onderaan","accommodaties_aanvullend_breed","types_breed"),array($db->f("accommodatie_id"),$db->f("type_id"),$db->f("accommodatie_id"),$db->f("accommodatie_id"),$db->f("type_id")));
	$foto_table="";
	if($video_url) {
		$foto_table.="<tr>";
		$foto_table.="<td align=\"center\"><div class=\"foto_doorklik\">";
		$foto_table.="<a href=\"".wt_he($video_url)."\" class=\"vimeo_fancybox\">";
		$foto_table.="<img src=\"".$vars['path']."pic/video-preview_".$vars["seizoentype"].".jpg\" width=\"200\" height=\"150\" border=\"0\" border=\"0\" style=\"margin-top:2px;margin-right:4px\" class=\"noprint\">";
		$foto_table.="</a><br><img src=\"".$path."pic/foto_doorklik.png\" alt=\"\" width=\"15\" height=\"11\" align=\"right\" border=\"0\" style=\"margin-top:2px;margin-right:4px\" class=\"noprint\"></a>&nbsp;</div></div></td>";
		$trcounter++;
	}

	if (count($files['all']['pic']) > 0 || count($files['all']['picbreed']) > 0 || count($files['all']['onderaan']) > 0) {

		if (count($files['all']['pic']) > 0) {

            foreach ($files['all']['pic'] as $key => $file) {

                $value = $file;

                if ($value === $afbeelding && false === $files['always']) {
                    continue;
                }

				if (!file_exists('pic/cms/' . $value)) {
					continue;
				}

				if($trcounter==3) {

					$foto_table.="</tr><tr>";
					unset($trcounter);
				}

				$trcounter++;
				$counter++;
				$foto_table.="<td align=\"center\">";

				if(preg_match("/accommodaties_aanvullend\/(.*.jpg)/",$value,$regs)) {
					$thumbnail="pic/cms/accommodaties_aanvullend_tn/".$regs[1];
					if(!file_exists($thumbnail) or filemtime($thumbnail)<>filemtime("pic/cms/".$value)) {
						unset($thumbnail);
					}
				} else {
					unset($thumbnail);
				}
				$size=getimagesize("pic/cms/".$value);
				if($size[0]>300) {
					if($size[0]>600 or $size[1]>450) {
						$grotefoto=$vars["path"]."thumbnail.php?calcsize=1&file=".urlencode($value)."&cache=";
					} else {
						$grotefoto=$path."pic/cms/".$value."?cache=";
					}
					$foto_table.="<div class=\"foto_doorklik\"><a href=\"".wt_he($grotefoto).filemtime("pic/cms/".$value)."\" class=\"fotopopup\" data-teller=\"".$counter."\" rel=\"group1\">";
					$foto_table.="<img src=\"";
					if($thumbnail) {
						$foto_table.=$path.$thumbnail."?cache=".@filemtime("pic/cms/".$value);
					} else {
#						$foto_table.=$path."thumbnail.php?file=".urlencode($value)."&cache=".@filemtime("pic/cms/".$value);
						$foto_table.=imageurl($value);
					}
					$foto_table.="\" title=\"".html("klikopdefoto","imagetable")."\" width=\"200\" height=\"150\" border=\"0\">";
					if(!$vars["accommodatie_word"]) {
						$foto_table.="<br><img src=\"".$path."pic/foto_doorklik.png\" alt=\"\" width=\"15\" height=\"11\" align=\"right\" border=\"0\" style=\"margin-top:2px;margin-right:4px\" class=\"noprint\"></a>&nbsp;</div>";
					}
					$vergroting=true;
				} else {
					if($size[0]>200) {
#						$foto_table.="<img src=\"".$path."thumbnail.php?file=".urlencode($value)."\" alt=\"\" width=\"200\" height=\"150\" border=\"0\">";
						$foto_table.="<img src=\"".imageurl($value)."\" alt=\"\" width=\"200\" height=\"150\" border=\"0\">";
					} else {
						$foto_table.="<img src=\"".$path."pic/cms/".$value."\" alt=\"\" width=\"200\" height=\"150\">";
					}
				}
				$foto_table.="</TD>";
			}
		}

		if (count($files['all']['picbreed']) > 0) {

            foreach ($files['all']['picbreed'] as $key => $file) {

                $value = $file;

                if ($value === $afbeelding && false === $files['always']) {
                    continue;
                }

				if (!file_exists('pic/cms/' . $value)) {
					continue;
				}

				$counter++;

                if($trcounter==1) {
					$foto_table.="<td colspan=\"2\" align=\"center\">";
				} else {
					$foto_table.="</tr>";
					$foto_table.="<tr><td colspan=\"3\" align=\"center\">";
				}

				$size=getimagesize("pic/cms/".$value);
				if($size[0]>500) {
					if($size[0]>=950) {
						$temp_w=950;
						$temp_h=356;
					} else {
						$temp_w=$size[0];
						$temp_h=$size[1];
					}
					$grotefoto=$vars["path"]."thumbnail.php?w=".$temp_w."&h=".$temp_h."&file=".urlencode($value)."&cache=";
					$foto_table.="<div class=\"foto_doorklik_groot\"><a href=\"".wt_he($grotefoto).filemtime("pic/cms/".$value)."\" class=\"fotopopup\" data-teller=\"".$counter."\" rel=\"group1\">";
					$foto_table.="<img src=\"";
					$foto_table.=imageurl($value, 400, 150);
					$foto_table.="\" title=\"".html("klikopdefoto","imagetable")."\" width=\"400\" height=\"150\" border=\"0\">";
					if(!$vars["accommodatie_word"]) {
						$foto_table.="<br><img src=\"".$path."pic/foto_doorklik.png\" alt=\"\" width=\"15\" height=\"11\" align=\"right\" border=\"0\" style=\"margin-top:2px;margin-right:4px\" class=\"noprint\"></a>&nbsp;</div>";
					}
				} else {
					if($size[0]>400) {
						$foto_table.="<img src=\"".imageurl($value, 400, 150)."\" alt=\"\" width=\"400\" height=\"150\" border=\"0\">";
					} else {
						$foto_table.="<img src=\"".$path."pic/cms/".$value."\" alt=\"\" width=\"400\" height=\"150\">";
					}
				}
				$foto_table.="</td></tr>";
				unset($trcounter);
			}
		} else {
			$foto_table.="</TR>";
		}
#		echo "<TABLE width=\"660\" border=\"0\" class=\"toonacctabel\" cellspacing=\"0\">";
#		echo "<TR><TH>".html("fotos","vars")."</TH><TH style=\"text-align:right;font-size:0.7em;\" class=\"noprint\">";
#		if($vergroting) {
#			echo "<img src=\"".$path."pic/foto_doorklik.png\" alt=\"\" width=\"15\" height=\"11\" border=\"0\"> = ".html("klikvoorvergroting","imagetable");
#		} else {
#			echo "&nbsp;";
#		}
	}
	if($foto_table) {
		echo "<table cellspacing=\"0\" cellpadding=\"5\" border=\"0\">";
		echo $foto_table;
		echo "</table>";
		echo "<br><i>".html("fotosindicatief","imagetable")."</i>";
	} else {
		echo "<i>".html("geenfotos","toonaccommodatie")."</i>";
	}
	echo "</div><!-- afsluiten_tabs_fotos -->";
	echo "<div id=\"ligging\">";
	echo "<div class=\"onlyprint\"><br>&nbsp;<br><h3>".html("ligging","toonaccommodatie")."</h3></div>";
	echo "<table width=\"660\" border=\"0\" cellspacing=\"0\" cellpadding=\"5\">";
	$pdf_plattegrond="pdf/plaats_plattegrond/".$accinfo["plaats_id"].".pdf";
	if($vars["websitetype"]==6) {
		# Vallandry
		echo "<tr><td width=\"175\" nowrap>".html("plaats","toonaccommodatie")."</TD><TD><a href=\"".$path.txt("canonical_accommodatiepagina")."/".txt("menu_plaats")."/".wt_convert2url_seo($db->f("plaats"))."/#beschrijving\">".wt_he($db->f("plaats"))."</A>".(file_exists($pdf_plattegrond) ? " - <a href=\"".$path.wt_he($pdf_plattegrond)."\" target=\"_blank\">".html("pdfplattegrond","toonaccommodatie")."</a>" : "")."</TD></TR>";
		if($vars["seizoentype"]==1) {
			echo "<tr><td width=\"175\" nowrap>".html("skigebied","toonaccommodatie")."</TD><TD><a href=\"".$path.txt("canonical_accommodatiepagina")."/".txt("menu_skigebied")."/".wt_convert2url_seo($db->f("skigebied"))."/\">".wt_he($db->f("skigebied"))." - ".wt_he($db->f("land"))."</A></TD></TR>";
		}
	} else {
		echo "<tr><td width=\"175\" nowrap>".html("plaats","toonaccommodatie")."</TD><TD><A HREF=\"".$path.txt("canonical_accommodatiepagina")."/".txt("menu_plaats")."/".wt_convert2url_seo($db->f("plaats"))."/?backtypeid=".$db->f("type_id").($url[1] ? "&backqs=".urlencode(substr($url[1],1)) : "")."#beschrijving\">".wt_he($db->f("plaats"))."</A>".(file_exists($pdf_plattegrond) ? " - <a href=\"".$path.wt_he($pdf_plattegrond)."\" target=\"_blank\">".html("pdfplattegrond","toonaccommodatie")."</a>" : "")."</TD></TR>";
		echo "<tr><td width=\"175\" nowrap>".html("skigebied","toonaccommodatie")."</TD><TD><A HREF=\"".$path.txt("canonical_accommodatiepagina")."/".txt("menu_skigebied")."/".wt_convert2url_seo($db->f("skigebied"))."/?backtypeid=".$db->f("type_id").($url[1] ? "&backqs=".urlencode(substr($url[1],1)) : "")."\">".wt_he($db->f("skigebied"))." - ".wt_he($db->f("land"))."</A></TD></TR>";
	}
#	if($vars["seizoentype"]==2) {
#		if($db->f("plaatsomschrijving")) echo "<tr><td valign=\"top\" width=\"175\" nowrap>".html("omschrijving","toonaccommodatie")."</TD><TD>".nl2br(wt_htmlent($db->f("plaatsomschrijving")))."</TD></TR>";
#	}
	if($vars["taal"]=="nl") echo "<tr><td width=\"175\" nowrap>Afstand tot Utrecht</td><td>".$db->f("afstandtotutrecht")." ".html("kilometer","toonaccommodatie")."</td></tr>";
	if($db->f("afstandwinkel") or $db->f("afstandwinkel")=="0") echo "<tr><td width=\"175\" nowrap>".html("afstandtotwinkels","toonaccommodatie")."</td><td>".wt_he(distance::show($db->f("afstandwinkel") ,$db->f("afstandwinkelextra")))."</td></tr>";
	if($db->f("afstandrestaurant") or $db->f("afstandrestaurant")=="0") echo "<tr><td width=\"175\" nowrap>".html("afstandrestaurantbar","toonaccommodatie")."</td><td>".wt_he(distance::show($db->f("afstandrestaurant") ,$db->f("afstandrestaurantextra")))."</td></tr>";
	if($vars["seizoentype"]==1) {
		if($db->f("afstandpiste") or $db->f("afstandpiste")=="0") echo "<tr><td width=\"175\" nowrap>".html("afstandpiste","toonaccommodatie")."</td><td>".wt_he(distance::show($db->f("afstandpiste") ,$db->f("afstandpisteextra")))."</td></tr>";
		if($db->f("afstandskilift") or $db->f("afstandskilift")=="0") echo "<tr><td width=\"175\" nowrap>".html("afstandskilift","toonaccommodatie")."</td><td>".wt_he(distance::show($db->f("afstandskilift") ,$db->f("afstandskiliftextra")))."</td></tr>";
		if($db->f("afstandloipe") or $db->f("afstandloipe")=="0") echo "<tr><td width=\"175\" nowrap>".html("afstandloipe","toonaccommodatie")."</td><td>".wt_he(distance::show($db->f("afstandloipe") ,$db->f("afstandloipeextra")))."</td></tr>";
		if($db->f("afstandskibushalte") or $db->f("afstandskibushalte")=="0") echo "<tr><td width=\"175\" nowrap>".html("afstandskibushalte","toonaccommodatie")."</td><td>".wt_he(distance::show($db->f("afstandskibushalte") ,$db->f("afstandskibushalteextra")))."</td></tr>";
	} else {
		if($db->f("afstandstrand") or $db->f("afstandstrand")=="0") echo "<tr><td width=\"175\" nowrap>".html("afstandstrand","toonaccommodatie")."</td><td>".wt_he(distance::show($db->f("afstandstrand") ,$db->f("afstandstrandextra")))."</td></tr>";
	}

	// known city / bekende stad
	if($db->f("afstandbekendestad") and $db->f("bekendestad")) echo "<tr><td width=\"175\" nowrap>".html("afstandbekendestad","toonaccommodatie", array("v_stad"=>$db->f( "bekendestad" )))."</td><td>".wt_he(distance::show($db->f("afstandbekendestad")*1000 ,$db->f("afstandbekendestadextra")))."</td></tr>";

	echo implode('', $extraDistancesHtml);

	echo "</table>";
	if(($db->f("gps_lat")<>"" and $db->f("gps_long")<>"") or ($db->f("tgps_lat")<>"" and $db->f("tgps_long")<>"")) {
		# Google Maps - plattegrond
		if(($db->f("tgps_lat")<>"" and $db->f("tgps_long")<>"")) {
			$gps_lat=$db->f("tgps_lat");
			$gps_long=$db->f("tgps_long");
		} else {
			$gps_lat=$db->f("gps_lat");
			$gps_long=$db->f("gps_long");
		}
		echo "<script>\n
			var mapOptions = {};
		";
		if($_SERVER["DOCUMENT_ROOT"]=="/home/webtastic/html" || defined('wt_test') && true === wt_test) {
			echo "mapOptions.googlemaps_base='" . (defined('wt_test_url_suffix') ? wt_test_url_suffix . '/' : '/chalet/') . "';\n";
		}
		$db0->query("SELECT MIN(optimaalaantalpersonen) AS optimaalaantalpersonen, MAX(maxaantalpersonen) AS maxaantalpersonen FROM view_accommodatie WHERE accommodatie_id='".$db->f("accommodatie_id")."' AND atonen=1 AND ttonen=1 AND websites LIKE '%".$vars["website"]."%' GROUP BY accommodatie_id;");
		if($db0->next_record()) {
			echo "mapOptions.googlemaps_aantalpersonen='".$db0->f("optimaalaantalpersonen").($db0->f("maxaantalpersonen")>$db0->f("optimaalaantalpersonen") ? " - ".$db0->f("maxaantalpersonen") : "")." ".html("personen")."';\n";
		}
		if(file_exists('pic/cms/' . $afbeelding) && $afbeelding != 'accommodaties/0.jpg') {
			echo "mapOptions.googlemaps_afbeelding='".imageurl($afbeelding,170,127)."';\n";
		}
		echo "mapOptions.googlemaps_accid=".$db->f("accommodatie_id").";\n mapOptions.googlemaps_typeid=".$db->f("type_id").";\n mapOptions.googlemaps_selected_icon=".$vars["websitetype"].";\n mapOptions.googlemaps_lat=".$gps_lat.";\n mapOptions.googlemaps_long=".$gps_long.";\n mapOptions.gps_coordinaten_bekend=1;\n mapOptions.googlemaps_naam='".addslashes(wt_he(ucfirst($vars["soortaccommodatie"][$db->f("soortaccommodatie")])." ".$db->f("naam")))."';\n mapOptions.googlemaps_plaatsland='".addslashes(wt_he($db->f("plaats").", ".$db->f("skigebied")))."';\n mapOptions.zoomlevel=".($vars["seizoentype"]==2 ? "9" : "14").";\n";
		echo "mapOptions.googlemaps_kwaliteit='".$kwaliteit."';\n mapOptions.googlemaps_omschrijving='".addslashes($omschrijving)."';\n";

		$q = "SELECT prijs FROM `cache_vanafprijs_type` WHERE type_id='$typeid' LIMIT 1";
		$db0->query($q);
		$db0->next_record();
		if($db0->f("prijs") && $db0->f("prijs")!=0) {

			$str = " mapOptions.googlemaps_tarief='vanaf &euro;&nbsp;".number_format($db0->f("prijs"),0,",",".");
			if($db->f("toonper")==3 or $vars["wederverkoop"]) {
				$str .= " ". html("peraccommodatie","zoek-en-boek");
			} else {
				$str .= " " . html("perpersoon","zoek-en-boek")."<br>".html("inclusiefskipas","zoek-en-boek");
			}
			$str .= "';\n";
			echo $str;

		}

		echo "</script>\n";

		echo "<div id=\"map_canvas\"></div>";
		if($vars["websitetype"]<>6) {
			# op alle sites behalve Chalets in Vallandry de button "Bekijk al onze accommodaties in dit gebied" tonen
			echo "<div id=\"googlemaps_deleteother\" class=\"button noprint\" onclick=\"googlemaps_deletemarkers();\">".html("andereaccommodatieswissen","toonaccommodatie")."</div>";
			echo "<div id=\"googlemaps_other\" class=\"button noprint\" onclick=\"googlemaps_show_other_acc();\">".html("bekijkalonzeaccommodatiesinditgebied","toonaccommodatie")."</div>";

			echo "<div style=\"clear: both;\"></div>\n";

			echo "<p style=\"font-style:italic;margin-top:10px;\">".html("kaartkanafwijken","toonaccommodatie")."</p>";
		}
	}
	echo "</div><!-- afsluiten_tabs_ligging -->";
	# Tab "Extra opties"
	echo "<div id=\"extraopties\">";
	echo "<div class=\"onlyprint\"><br>&nbsp;<br></div>";

	if(is_array($seizoen_tarieven)) {
		foreach ($seizoen_tarieven as $key => $value) {
			unset($gratis_optie,$tarieven_ingevuld,$niet_hetzelfde,$toon_optie_pulldown,$optiesoort_beschikbaar);
			$seizoenid=$key;
			$db2->query("SELECT s.optie_soort_id, s.naam".$vars["ttv"]." AS naam, s.omschrijving".$vars["ttv"]." AS omschrijving FROM optie_soort s, optie_accommodatie a WHERE ".($vars["reisverzekering_mogelijk"] ? "" : "s.reisverzekering=0 AND ").($vars["wederverkoop"] ? "s.beschikbaar_wederverkoop=1 AND " : "s.beschikbaar_directeklanten=1 AND ")."a.accommodatie_id='".addslashes($accid)."' AND a.optie_soort_id=s.optie_soort_id AND s.naam".$vars["ttv"]."<>'' ORDER BY s.volgorde, s.naam".$vars["ttv"].";");
			if($db2->num_rows()) {
				unset($optie_tabel_html,$toon_optie_pulldown);
				while($db2->next_record()) {
					unset($optiesoort_tabel_html,$optiesoort_beschikbaar);
					if($_GET["optie_datum"] and (!$_GET["otsid"] or $_GET["otsid"]==$seizoenid)) {
						$db3->query("SELECT o.naam".$vars["ttv"]." AS naam, o.optie_onderdeel_id, g.optie_groep_id, g.omschrijving".$vars["ttv"]." AS omschrijving, t.verkoop, t.beschikbaar FROM optie_onderdeel o, optie_groep g, optie_tarief t, optie_soort s, optie_accommodatie a WHERE a.accommodatie_id='".addslashes($accid)."' AND a.optie_soort_id=s.optie_soort_id AND a.optie_groep_id=g.optie_groep_id AND t.optie_onderdeel_id=o.optie_onderdeel_id AND o.tonen_accpagina=1 AND t.seizoen_id='".addslashes($seizoenid)."' AND t.week='".addslashes($_GET["optie_datum"])."' AND g.optie_soort_id='".$db2->f("optie_soort_id")."' AND g.optie_soort_id=s.optie_soort_id AND g.optie_groep_id=o.optie_groep_id AND o.naam".$vars["ttv"]."<>'' AND o.actief=1 ORDER BY o.volgorde, o.naam".$vars["ttv"].";");
					} else {
						$db3->query("SELECT o.naam".$vars["ttv"]." AS naam, o.optie_onderdeel_id, g.optie_groep_id, g.omschrijving".$vars["ttv"]." AS omschrijving FROM optie_onderdeel o, optie_groep g, optie_soort s, optie_accommodatie a WHERE a.accommodatie_id='".addslashes($accid)."' AND a.optie_soort_id=s.optie_soort_id AND a.optie_groep_id=g.optie_groep_id AND g.optie_soort_id='".$db2->f("optie_soort_id")."' AND g.optie_soort_id=s.optie_soort_id AND o.tonen_accpagina=1 AND g.optie_groep_id=o.optie_groep_id AND o.naam".$vars["ttv"]."<>'' AND o.actief=1 ORDER BY o.volgorde, o.naam".$vars["ttv"].";");
					}
					if($db3->next_record()) {
						$optiesoort_tabel_html.="<tr><td valign=\"top\" width=\"175\" nowrap>".wt_he($db2->f("naam"));
						if($db2->f("omschrijving") or $db3->f("omschrijving")) {
							$lengte=strlen($db2->f("omschrijving").$db3->f("omschrijving"));
							$optiesoort_tabel_html.=" <font size=1><br><span class=\"noprint\">(<A HREF=\"javascript:popwindow(500,0,'".$path."popup.php?id=opties&gid=".$db3->f("optie_groep_id")."');\">".html("meerinformatie","toonaccommodatie")."</a>)</span></font>";
						}
						$optiesoort_tabel_html.="</TD><TD>";
						$optiesoort_tabel_html.="<TABLE class=\"optietabel\" cellspacing=\"0\" border=\"0\" width=\"460\">";
						$db3->seek();
						while($db3->next_record()) {
							unset($verkoop,$niet_hetzelfde,$tarieven_ingevuld);
							$gratis_optie=true;
							$db4->query("SELECT t.verkoop FROM optie_tarief t WHERE t.seizoen_id='".addslashes($seizoenid)."' AND t.beschikbaar=1 AND t.optie_onderdeel_id='".addslashes($db3->f("optie_onderdeel_id"))."';");
							while($db4->next_record()) {
								$tarieven_ingevuld=true;
								if($db4->f("verkoop")<>0) $gratis_optie=false;
								if($verkoop) {
									if($db4->f("verkoop")<>$verkoop and $db4->f("verkoop")<>0) {
										$niet_hetzelfde=true;
										$toon_optie_pulldown=true;
									}
								} else {
									$verkoop=$db4->f("verkoop");
								}
							}
							if($niet_hetzelfde) unset($verkoop);
							if($_GET["optie_datum"]) {
								if($db3->f("verkoop")<>0) $gratis_optie=false;
								$verkoop=$db3->f("verkoop");
								$tarieven_ingevuld=true;
							}
							if($verkoop<0) {
								$verkoop=abs($verkoop);
								$korting=true;
							} else {
								$korting=false;
							}
							if($tarieven_ingevuld and (!$_GET["optie_datum"] or $db3->f("beschikbaar")==1) and ($verkoop<>0 or $gratis_optie or !$_GET["optie_datum"])) {
								$optiesoort_tabel_html.="<tr><td width=\"350\">".wt_he($db3->f("naam"))."</TD>";
								if($verkoop<>0 or $gratis_optie) {
									$optiesoort_tabel_html.="<TD width=\"45\" align=\"right\">".($korting ? html("korting","vars") : "")."&nbsp;</TD>";
									if($gratis_optie) {
										$optiesoort_tabel_html.="<TD>&nbsp;</TD><TD width=\"60\" align=\"right\">".html("gratis","toonaccommodatie")."</TD>";
									} else {
										$optiesoort_tabel_html.="<TD>&euro;&nbsp;</TD><TD width=\"60\" align=\"right\">".number_format($verkoop,2,',','.')."</TD>";
									}
								} else {
									$optiesoort_tabel_html.="<TD colspan=\"3\" nowrap align=\"right\">".html("afhankelijkvandatum","toonaccommodatie")."</TD>";
									$toon_optie_pulldown=true;
								}
								$optiesoort_tabel_html.="</TR>";
								$optiesoort_beschikbaar=true;
							}
						}
						$optiesoort_tabel_html.="</TABLE></TD></TR>";
						if($optiesoort_beschikbaar) {
							$optie_tabel_html.=$optiesoort_tabel_html;
						}
					}
				}
				if($optie_tabel_html and $optietarieventonen[$seizoenid]) {
					echo "<table width=\"660\" border=\"0\" class=\"toonacctabel optietabelclass\" cellspacing=\"0\">";
#					echo "<a name=\"extraopties_optietabel\"></a>";
					echo "<form name=\"optietabel".$seizoenid."\" method=\"get\" action=\"".wt_he($_SERVER["REQUEST_URI"])."\">";
					echo "<input type=\"hidden\" name=\"otsid\" value=\"".$seizoenid."\">";
					echo "<input type=\"hidden\" name=\"selecttab\" value=\"extraopties\">\n";

					@reset($_GET);
					while(list($key2,$value2)=@each($_GET)) {
						if($key2<>"optie_datum" and $key2<>"selecttab" and !is_array($value2)) echo "<input type=\"hidden\" name=\"".$key2."\" value=\"".wt_he($value2)."\">\n";
					}
					echo "<TR><TH colspan=\"2\">".html("opties","toonaccommodatie")." ".wt_he($value);
					if($toon_optie_pulldown) {
						unset($optie_pulldown_html,$optie_pulldown_teller);
						if(!$_GET["optie_datum"] and $aankomstdatum) $_GET["optie_datum"]=$aankomstdatum;
						$optie_pulldown_html.="&nbsp;&nbsp;&nbsp;&nbsp;<select name=\"optie_datum\" style=\"font-weight: normal;\" class=\"noprint\" onchange=\"document.optietabel".$seizoenid.".submit();\">";
						if(!$_GET["d"]) $optie_pulldown_html.="<option".(!$_GET["optie_datum"] ? " selected" : "")." value=\"\">-- ".html("kiesdegewensteaankomstdatum","toonaccommodatie")." --</option>";
						$week=$seizoen_begin[$seizoenid];
						while($week<=$seizoen_eind[$seizoenid]) {
							if($accinfo["aankomstdatum_tariefingevoerd"][$week]) {
								$optie_pulldown_html.="<option ".($_GET["optie_datum"]==$week ? "selected " : "")."value=\"".$week."\">&nbsp;".html("optietarieven","toonaccommodatie")." ".$accinfo["aankomstdatum_tariefingevoerd"][$week]."&nbsp;</option>";
								$optie_pulldown_teller++;
							}
							$week=mktime(0,0,0,date("m",$week),date("d",$week)+7,date("Y",$week));
						}
						$optie_pulldown_html.="</select>";

						if($vars["accommodatie_word"]) {
							unset($optie_pulldown_html);
						}
						if($optie_pulldown_teller) echo $optie_pulldown_html;
					}

					echo "</TH></TR>";
					echo "</form>";

					echo $optie_tabel_html;
					$optie_tabel_html_getoond=true;

					# Sunny Cars
					if($vars["seizoentype"]==2 and $vars["taal"]=="nl") {
						echo "<tr><td valign=\"top\">Autohuur&nbsp;</td><td valign=\"top\">Ter plaatse een auto huren? <a href=\"#extraopties\" onclick=\"popwindowXY(1000,330,'" . sunnycars_partner_link . "',true);recordOutboundPopup('Externe popup','Sunny Cars');\">Boek dan direct bij Sunny Cars</a>.</td></tr>";
					} elseif($vars["website"]=="C") {
						echo "<tr><td valign=\"top\">Autohuur&nbsp;</td><td valign=\"top\">Een auto huren? <a href=\"#extraopties\" onclick=\"popwindowXY(1000,330,'" . sunnycars_partner_link . "',true);recordOutboundPopup('Externe popup','Sunny Cars');\">Boek dan direct bij Sunny Cars</a>.</td></tr>";
					}

					echo "</table>";
				}
			}
		}
	}
	if($db->f("extraopties")) {
		echo "<div style=\"padding-top:15px;\">".nl2br(wt_htmlent($db->f("extraopties")))."</div>";
	}

	if(!$optie_tabel_html_getoond and !$db->f("extraopties")) {
		echo html("geenopties","toonaccommodatie");
	}



	echo "</div><!-- afsluiten_tabs_opties -->";

	# Tab "prijsinformatie"
	echo "<div id=\"prijsinformatie\">";
	echo "<div style=\"margin-left:-7px;margin-right:-7px;\">";
	echo "<div class=\"onlyprint\"><br>&nbsp;<br></div>";

	if(($_GET["toonflex"] or ($_GET["flad"] and $_GET["fldu"])) and $accinfo["flexibel"]) {
		if($_GET["flad"] and $_GET["fldu"]) {
			$flextarief=bereken_flex_tarief($typeid,$_GET["flad"],$_GET["fldu"]);
		}

		$flex_einddatum=mktime(0,0,0,date("m",$_GET["flad"]),date("d",$_GET["flad"])+$flextarief["aantalnachten"],date("Y",$_GET["flad"]));

#		echo "<a name=\"prijsinformatie_flextarieven\"></a>";
		echo "<table width=\"660\" class=\"toonacctabel\" cellspacing=\"0\" style=\"width:690px;\">";
		if($flextarief["aantalnachten"]) {
			echo "<tr><th>".html("prijs-bij-flex", "toonaccommodatie", array("v_aankomstdatum"=>DATUM("DAG D MAAND JJJJ", $_GET["flad"], $vars["taal"]), "v_verblijfsduur"=>$flextarief["aantalnachten_text"]))."</th></tr>";
		} else {
			echo "<tr><th>".html("voer-verblijfsperiode-in", "toonaccommodatie").":</th></tr>";
		}
		echo "<tr><td>";

		echo "<form method=\"get\" action=\"".wt_he($_SERVER["REQUEST_URI"])."\" name=\"zoeken\" id=\"zoeken\">";
		echo "<input type=\"hidden\" name=\"selecttab\" value=\"prijsinformatie\">\n";

		reset($_GET);
		while(list($key,$value)=each($_GET)) {
			if($key<>"fadf_d" and $key<>"fadf_m" and $key<>"fadf_y") {
				echo "<input type=\"hidden\" name=\"".wt_he($key)."\" value=\"".wt_he($value)."\">\n";
			}
		}
		if(!$_GET["flad"]) {
			echo "<input type=\"hidden\" name=\"flad\" value=\"\">\n";
		}

		echo "<table border=\"0\" width=\"500\" cellspacing=\"0\" cellpadding=\"0\" class=\"geenbordertable\">";
		echo "<tr><td colspan=\"2\">";
		if($flextarief["tarief"]>0) {
			echo "<b>".html("prijs-per-accommodatie", "toonaccommodatie").": ";
			echo "&euro;&nbsp;".number_format($flextarief["tarief"],2,",",".");
			echo "</b>";
		} else {
			if($_GET["flad"] and $_GET["fldu"]) {
				echo html("gekozen-periode-niet-beschikbaar", "toonaccommodatie");
			}
		}
		echo "</td></tr>";

		echo "<tr><td><img src=\"".$path."pic/leeg.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>";

		echo "<tr><td valign=bottom>".html("aankomstdatum","accommodaties")."</td><td valign=top align=left width=65%>";

		# Kalender
		echo "<img src=\"".$vars["path"]."pic/class.form_calendar.gif\" border=\"0\" onClick=\"window.open('".$vars["path"]."calendar.php?accpagina=1&nm=zoeken&lang=".$vars["taal"]."&justonevar=1&input=fadf&month='+document.zoeken.elements['fadf_m'].value+'&year='+document.zoeken.elements['fadf_y'].value, '_blank', 'scrollbars=no,width=445,height=250,left=0,top=0');\" width=\"16\" height=\"15\" alt=\"Kalender\" style=\"cursor: pointer\">&nbsp;";

		if($_GET["flad"]) {
			$temp_actievedatum["fadf_d"]=date("d",$_GET["flad"]);
			$temp_actievedatum["fadf_m"]=date("m",$_GET["flad"]);
			$temp_actievedatum["fadf_y"]=date("Y",$_GET["flad"]);
		}

		# dag
		echo "<select name=\"fadf_d\" onchange=\"accommodatiepagina_flexibel_onchange();\">";
		if(!$_GET["flad"]) {
			echo "<option value=\"0\"></option>";
		}
		for($i=1;$i<=31;$i++) {
			echo "<option value=\"".$i."\"".($temp_actievedatum["fadf_d"]==$i ? " selected" : "").">".$i."</option>";
		}
		echo "</select>";

		echo "&nbsp;&nbsp;";

		# maand
		echo "<select name=\"fadf_m\" onchange=\"accommodatiepagina_flexibel_onchange();\">";
		if(!$_GET["flad"]) {
			echo "<option value=\"0\"></option>";
		}
		for($i=1;$i<=12;$i++) {
			echo "<option value=\"".$i."\"".($temp_actievedatum["fadf_m"]==$i ? " selected" : "").">".DATUM("MAAND",mktime(0,0,0,$i,1,2010),$vars["taal"])."</option>";
		}
		echo "</select>";

		echo "&nbsp;&nbsp;";

		# jaar
		echo "<select name=\"fadf_y\" onchange=\"accommodatiepagina_flexibel_onchange();\">";
		if(!$_GET["flad"]) {
			echo "<option value=\"0\"></option>";
		}
		for($i=date("Y");$i<=date("Y")+1;$i++) {
			echo "<option value=\"".$i."\"".($temp_actievedatum["fadf_y"]==$i ? " selected" : "").">".$i."</option>";
		}
		echo "</select>";
		echo "</td></tr>";
		echo "<tr><td valign=bottom>".html("verblijfsduur","accommodaties")."</td><td valign=top align=left width=65%>";

		# Verblijfsduur
		unset($vars["verblijfsduur"]);
		$vars["verblijfsduur"]["1"]="1 ".txt("week","vars");
		$vars["verblijfsduur"]["2"]="2 ".txt("weken","vars");
		$vars["verblijfsduur"]["3"]="3 ".txt("weken","vars");
		$vars["verblijfsduur"]["4"]="4 ".txt("weken","vars");
		// $vars["verblijfsduur"]["1n"]="1 ".txt("nacht","vars");
		for($i=3;$i<=$vars["flex_max_aantalnachten"];$i++) {
			$vars["verblijfsduur"][$i."n"]=$i." ".txt("nachten","vars");
		}
		echo "<select name=\"fldu\" class=\"formstyle100\" onchange=\"accommodatiepagina_flexibel_onchange();\">";
		reset($vars["verblijfsduur"]);
		while(list($key,$value)=each($vars["verblijfsduur"])) {
			if(preg_match("/n/",$key)) {
				if(!$key_gehad["nachten"]) {
					echo "</optgroup><optgroup label=\"".html("aantalnachten")."\">\n";
					$key_gehad["nachten"]=true;
				}
			} else {
				if(!$key_gehad["weken"]) {
					echo "<optgroup label=\"".html("aantalweken")."\">\n";
					$key_gehad["weken"]=true;
				}

			}
			echo "<option value=\"".$key."\"";
			if($_GET["fldu"]==$key) {
				echo " selected";
			}
			echo ">".wt_he($value)."</option>";
		}
		echo "</optgroup></select>";
		echo "</td></tr>";

		echo "</table>";

		echo "</form>";

		echo "</td></tr>";
		echo "</table>";

		$flex_tarief_getoond=true;
	}

	# Melding over flexibel verblijf
	if($echt_tarieven_getoond) {
		unset($flexmelding);
		if($accinfo["flexibel"] and $tarieven_getoond and !$_GET["toonflex"] and !$flex_tarief_getoond) {
			$flexurl=$_SERVER["REQUEST_URI"];
			if($_GET) $flexurl.="&"; else $flexurl.="?";
			$flexurl.="toonflex=1";
			if($_GET["d"]) {
				$flexurl.="&flad=".$_GET["d"];
				if($_GET["fdu"]>0) {
					$flexurl.="&fldu=".$_GET["fdu"];
				} else {
					$flexurl.="&fldu=1";
				}
			}
			$flexurl.="#prijsinformatie";
			echo "<table width=\"660\" border=\"0\" class=\"toonacctabel\" cellspacing=\"0\" id=\"bekijkflexibel\">";
			echo "<tr><td>";
			echo html("onderstaande-tarieven-za-za", "toonaccommodatie");
			echo "<br><a href=\"".wt_he($flexurl)."\">";
			echo html("beijk-ook-afwijkend", "toonaccommodatie")." &gt;</a>";
			echo "</td></tr></table>";
			$flexmelding=true;
		}
	}

	if($flex_tarief_getoond) {
		echo "<div style=\"margin-top:5px;margin-bottom:10px;width:688px;text-align:right;\" id=\"bekijkookweektarieven\">";
		if($echt_tarieven_getoond) {
			echo "<a href=\"#\" onclick=\"return weektarieven_openklappen();\">";
			if($_GET["toonflex"]) {
				echo html("bekijk-weektarieven", "toonaccommodatie");
			} else {
				echo html("bekijk-ook-weektarieven", "toonaccommodatie");
			}
			echo " &gt;</a>";
		}
		echo "</div>";
		echo "<div style=\"display:none;\" id=\"weektarieven\">";
	}

	# Aanbiedingen tonen
	@reset($seizoen_tarieven);
	while(list($key,$value)=@each($seizoen_tarieven)) {
		$seizoenid=$key;
		while(list($key2,$value2)=@each($aanbieding[$seizoenid]["aanbiedingid_sort"])) {
			unset($toonaanbieding);
			@reset($value2["weken"]);
			while(list($key3,$value3)=@each($value2["weken"])) {
				if($accinfo["aankomstdatum_beschikbaar"][$key3]) $toonaanbieding=true;
			}
			if($toonaanbieding and !$aanbiedingid_getoond[$key2] and ($value2["omschrijving"] or !$aanbiedingenblok_getoond)) {
				$aanbiedingid_getoond[$key2]=true;
				if($flexmelding) {
					echo "<br>";
					unset($flexmelding);
				}

				if($value2["omschrijving"] and $aanbieding_actief) {
					# aanbiedingblok (alleen tonen indien er een omschrijving is ingevuld)
					echo "<table width=\"660\" class=\"aanbiedingtabel\" cellspacing=\"0\">";
					echo "<tr><th colspan=\"2\">";
					if($value2["soortid"]==2) {
						if($value2["lastminute"]) {
							echo html("lastminute","vars");
						} else {
							echo html("aanbieding","toonaccommodatie");
						}
					} else {
						if($value2["soort"]) {
							echo wt_he(ucfirst($value2["soort"]));
						} else {
							html("aanbieding","toonaccommodatie");
						}
					}
					echo "</th></tr>";
					// echo "<tr style=\"height:0px;padding:0px;margin:0px;border:0px;\"><th style=\"height:0px;padding:0px;margin:0px;border:0px;\"><img src=\"".$path."pic/leeg.gif\" width=\"185\" height=\"0\" alt=\"\"></th><th style=\"height:0px;padding:0px;margin:0px;border:0px;\"><img src=\"".$path."pic/leeg.gif\" width=\"475\" height=\"0\" alt=\"\"></th></tr>";
					echo "<tr><td colspan=\"2\">";
					if($value2["omschrijving"]) {
						echo nl2br(wt_htmlent($value2["omschrijving"],true));
						if($value2["einddatum"] and $value2["einddatum"]<(time()+86400*7)) {
							echo "<br><br><i>".html("geldigtotenmet","toonaccommodatie")." ";
							echo DATUM("DAG D MAAND JJJJ",$value2["einddatum"],$vars["taal"])." (".html("zolangdevoorraadstrekt","toonaccommodatie").")</i>";
						} else {
	#						echo "<br><br><i>".html("geldigzolangdevoorraadstrekt","toonaccommodatie")."</i>";
						}
					} else {
	#					echo "<br><br><i>".html("geldigvoordeaangebodenweken","toonaccommodatie")."</i>";
					}
					$aanbiedingenblok_getoond=true;
					echo "</td></tr>";
					echo "</table><p>";
				}
			}
		}
	}

	if($voorkant_cms) {
		$db2->query("SELECT s.seizoen_id, s.naam, a.accommodatie_id, t.leverancier_id, UNIX_TIMESTAMP(s.eind) AS eind FROM seizoen s, accommodatie a, type t WHERE UNIX_TIMESTAMP(s.eind)>".(time()-86400*360)." AND t.type_id='".addslashes($typeid)."' AND t.accommodatie_id=a.accommodatie_id AND a.wzt=s.type AND s.seizoen_id IN (SELECT ".addslashes($vars["seizoentype_namen"][$db->f("wzt")])."_toon_tarievenlink_seizoen_id AS seizoen_id FROM diverse_instellingen) ORDER BY s.begin;");
		if($db2->num_rows()) {
			echo "<div style=\"margin-top:5px;margin-bottom:10px;padding:5px;border:1px solid #878481;width:650px;\" class=\"noprint\">Archief tarieven en beschikbaarheid:<br>";
			while($db2->next_record()) {
				echo "&bull;&nbsp;&nbsp;&nbsp;";
				echo "<a href=\"".$vars["cmspath"]."cms_tarieven.php?from=".wt_he(urlencode("http://".$_SERVER["HTTP_HOST"].$_SERVER["REQUEST_URI"]))."&sid=".$db2->f("seizoen_id")."&tid=".wt_he($typeid)."\">".wt_he($db2->f("naam"))."</a><br/>";
			}
			echo "</div>\n";
		}
	}

#	if($voorkant_cms and ($db->f("aantekeningen") or $db->f("taantekeningen"))) {
#		echo "<TABLE width=\"660\" border=\"0\" class=\"toonacctabel\" cellspacing=\"0\">";
#		echo "<TR><TH>Interne opmerkingen</TH></TR>";
#		echo "<tr><td valign=\"top\">";
#		if($db->f("aantekeningen")) echo nl2br(wt_he($db->f("aantekeningen")));
#		if($db->f("aantekeningen") and $db->f("taantekeningen")) echo "<p>";
#		if($db->f("taantekeningen")) echo nl2br(wt_he($db->f("taantekeningen")));
#		echo "</TD></TR>";
#		echo "</TABLE><p>";
#	}

	if($voorkant_cms) {
		// keuze tussen oude en nieuwe tarieventabel
		echo "<div style=\"padding:5px;border:1px solid #878481;width:650px;margin-bottom:10px;font-weight:bold;\">";
		$gewijzigde_url=$_SERVER["REQUEST_URI"];
		$gewijzigde_url=preg_replace("@tarieventabelversie=[0-9]@","",$gewijzigde_url);
		$gewijzigde_url=preg_replace("@&{2,}@","",$gewijzigde_url);
		$gewijzigde_url=preg_replace("@&$@","",$gewijzigde_url);
		if($nieuwe_tarieventabel) {
			echo "<a href=\"".wt_he($gewijzigde_url.(preg_match("@\?@",$gewijzigde_url) ? "&" : "?")."tarieventabelversie=1#prijsinformatie")."\">toon intern seizoensoverzicht &raquo;</a>";
		} else {
			echo "<a href=\"".wt_he($gewijzigde_url.(preg_match("@\?@",$gewijzigde_url) ? "&" : "?")."tarieventabelversie=2#prijsinformatie")."\">toon tarieventabel &raquo;</a>";
		}
		echo "</div>";
	}

	# Tarieventabellen tonen
	if($echt_tarieven_getoond) {


		if($nieuwe_tarieventabel) {
			echo "<a name=\"tar\"></a>";
			echo $tarieventabel_object_content;
			echo "<a name=\"optietabel\"></a>";
		} else {
			@reset($tarieventabel);
			while(list($key,$value)=@each($tarieventabel)) {
				$temp_seizoenteller++;
				if($tarieven_getoond[$key]) {
		#			if($seizoenen_inquery) $seizoenen_inquery.=",".$key; else $seizoenen_inquery=$key;
					echo "<p>";
					if($temp_seizoenteller==1) echo "<a name=\"tar\"></a>";
					echo $value;
					echo "<a name=\"optietabel\"></a>";
				}
			}
		}

		if($flex_tarief_getoond) {
			echo "</div>";
		} else {
			echo "<p>";
		}
	} else {
		if($tarieven_ingevoerd) {

			if($tarieventabel_object->mailmijvolgendseizoen_form) {
				echo $tarieventabel_object->mailmijvolgendseizoen_form;
				echo "<div style=\"margin-top:-10px;\"></div>";
			}

			# Seizoennamen bepalen (vorig seizoen, dit seizoen)
			$db2->query("SELECT DISTINCT s.naam".$vars["ttv"]." AS naam FROM seizoen s WHERE s.type='".$vars["seizoentype"]."' ORDER BY s.begin DESC LIMIT 0,2;");
			while($db2->next_record()) {
				if(!$volgend_seizoen) {
					$volgend_seizoen=$db2->f("naam");
				}
				$huidig_seizoen=$db2->f("naam");
			}
			echo "<p>".html("geentarieven_accvol","toonaccommodatie",array("v_accommodatienaam"=>$accinfo["accnaam"],"v_huidigseizoen"=>$huidig_seizoen,"v_volgendseizoen"=>$volgend_seizoen,"l1"=>"contact?accid=".$typeid))."</p>";


		} else {

			if($tarieventabel_object->mailmijvolgendseizoen_form) {
				echo $tarieventabel_object->mailmijvolgendseizoen_form;
				echo "<div style=\"margin-top:-10px;\"></div>";
			}

			echo "<p>".html("tarievennognietbekend","toonaccommodatie",array("l1"=>"contact?accid=".$typeid))."</p>";
		}
		echo "<br/>";
	}

	#
	# Inclusief/exclusief (onder tarieventabel)
	#
	if(!$nieuwe_tarieventabel or ($nieuwe_tarieventabel and !$echt_tarieven_getoond)) {

		if(is_object($tarieventabel_object)) {

			if(!$tarieventabel_object->first_seizoen_id) {
				$db->query("SELECT MAX(seizoen_id) AS seizoen_id FROM bk_type WHERE type_id='".$typeid."';");
				if($db->next_record()) {
					$tarieventabel_object->first_seizoen_id=$db->f("seizoen_id");
				}
			}

			if($nieuwe_tarieventabel) {
				echo $tarieventabel_object->show_bijkomendekosten();
			}
		} else {

			$tarieventabel_object_temp = new tarieventabel;
			$tarieventabel_object_temp->seizoen_id=$nieuwe_tarieventabel_seizoen_id_inquery;
			$tarieventabel_object_temp->type_id=$typeid;


			$db->query("SELECT MAX(seizoen_id) AS seizoen_id FROM bk_type WHERE type_id='".$typeid."';");
			if($db->next_record()) {
				$tarieventabel_object_temp->first_seizoen_id=$db->f("seizoen_id");
			}
			$tarieventabel_object_temp_content = $tarieventabel_object_temp->toontabel();

			// $tarieventabel_object_temp->tarieven_uit_database();

			if($nieuwe_tarieventabel) {
				echo $tarieventabel_object_temp->show_bijkomendekosten();
			}
		}

		// if($vars["wederverkoop"]) {
		// 	if($db->f("inclusief") or $db->f("tinclusief")) {
		// 		echo "<table width=\"660\" border=\"0\" class=\"toonacctabel\" cellspacing=\"0\">";
		// 		echo "<tr><th>".html("inclusief","toonaccommodatie")."</th></tr>";
		// 		echo "<tr><td>".toon_tekst_acc_en_type($db->f("inclusief"),$db->f("tinclusief"))."</td></tr>";
		// 		echo "</table><p>";
		// 	}
		// } else {
		// 	if($db->f("inclusief") or $db->f("tinclusief") or $skipas_website_omschrijving) {
		// 		echo "<table width=\"660\" border=\"0\" class=\"toonacctabel\" cellspacing=\"0\">";
		// 		echo "<tr><th>".html("inclusief","toonaccommodatie")."</th></tr>";
		// 		echo "<tr><td>";
		// 		if($skipas_website_omschrijving) echo toon_tekst_acc_en_type($skipas_website_omschrijving);
		// 		if($db->f("inclusief") or $db->f("tinclusief")) {
		// 			if($skipas_website_omschrijving) echo "<br><br>";
		// 			echo trim(toon_tekst_acc_en_type($db->f("inclusief"),$db->f("tinclusief")));
		// 		}
		// 		echo "</td></tr>";
		// 		echo "</table><p>";
		// 	}
		// }
		// // if($db->f("exclusief") or $db->f("texclusief")) {
		// 	echo "<table width=\"660\" border=\"0\" class=\"toonacctabel\" cellspacing=\"0\">";
		// 	echo "<tr><th>".html("exclusief","toonaccommodatie")."</th></tr>";
		// 	echo "<tr><td>";

		// 	$texclusief=trim($db->f("texclusief")."\n\n".txt("reserveringskosten", "vars")." ( ".$vars["reserveringskosten"].",- ".txt("perboeking", "vars").").");
		// 	echo toon_tekst_acc_en_type($db->f("exclusief"),$texclusief);
		// 	echo "</td></tr>";
		// 	echo "</table><p>";
		// // }

	}

	// if($echt_tarieven_getoond and !$nieuwe_tarieventabel) {
	// 	#
	// 	# Bijkomende kosten (onder tarieventabel)
	// 	#
	// 	# Bijkomende kosten gekoppeld aan accommodatie en type
	// 	$db2->query("SELECT a.bijkomendekosten1_id, a.bijkomendekosten2_id, a.bijkomendekosten3_id, a.bijkomendekosten4_id, a.bijkomendekosten5_id, a.bijkomendekosten6_id, t.bijkomendekosten1_id AS tbijkomendekosten1_id, t.bijkomendekosten2_id AS tbijkomendekosten2_id, t.bijkomendekosten3_id AS tbijkomendekosten3_id, t.bijkomendekosten4_id AS tbijkomendekosten4_id, t.bijkomendekosten5_id AS tbijkomendekosten5_id, t.bijkomendekosten6_id AS tbijkomendekosten6_id FROM accommodatie a, type t WHERE t.accommodatie_id=a.accommodatie_id AND t.type_id='".addslashes($typeid)."';");
	// 	if($db2->next_record()) {
	// 		for($i=1;$i<=6;$i++) {
	// 			if($db2->f("bijkomendekosten".$i."_id")) {
	// 				if($bijkomendekosten_inquery) $bijkomendekosten_inquery.=",".$db2->f("bijkomendekosten".$i."_id"); else $bijkomendekosten_inquery=$db2->f("bijkomendekosten".$i."_id");
	// 			}
	// 			if($db2->f("tbijkomendekosten".$i."_id")) {
	// 				if($bijkomendekosten_inquery) $bijkomendekosten_inquery.=",".$db2->f("tbijkomendekosten".$i."_id"); else $bijkomendekosten_inquery=$db2->f("tbijkomendekosten".$i."_id");
	// 			}
	// 		}
	// 	}

	// 	# Bijkomende kosten gekoppeld aan skipassen
	// 	if($accinfo["skipasid"]) {
	// 		$db2->query("SELECT bijkomendekosten_id FROM skipas WHERE skipas_id='".addslashes($accinfo["skipasid"])."';");
	// 		if($db2->next_record()) {
	// 			if($db2->f("bijkomendekosten_id")) {
	// 				if($bijkomendekosten_inquery) $bijkomendekosten_inquery.=",".$db2->f("bijkomendekosten_id"); else $bijkomendekosten_inquery=$db2->f("bijkomendekosten_id");
	// 			}
	// 		}
	// 	}

	// 	if($bijkomendekosten_inquery) {
	// 		$db2->query("SELECT b.bijkomendekosten_id, b.naam".$vars["ttv"]." AS naam, b.omschrijving".$vars["ttv"]." AS omschrijving, b.perboekingpersoon, b.min_personen FROM bijkomendekosten b WHERE b.bijkomendekosten_id IN (".$bijkomendekosten_inquery.") ORDER BY b.naam".$vars["ttv"].";");
	// 		if($db2->num_rows()) {
	// 			while($db2->next_record()) {
	// 				if($seizoenen_inquery) {
	// #					$db3->query("SELECT DISTINCT week, verkoop FROM bijkomendekosten_tarief WHERE bijkomendekosten_id='".$db2->f("bijkomendekosten_id")."' AND seizoen_id IN (".$seizoenen_inquery.")".($_GET["optie_datum"] ? " AND week='".addslashes($_GET["optie_datum"])."'" : "").";");
	// 					$db3->query("SELECT DISTINCT week, verkoop FROM bijkomendekosten_tarief WHERE bijkomendekosten_id='".$db2->f("bijkomendekosten_id")."' AND seizoen_id IN (".$seizoenen_inquery.");");
	// 					while($db3->next_record()) {
	// 						if($db3->f("verkoop")<>0) {
	// 							if(!isset($bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"])) {
	// 								$bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"]=$db3->f("verkoop");
	// 								$bijkomendekosten[$db2->f("bijkomendekosten_id")]["max"]=$db3->f("verkoop");
	// 							}
	// 							if($db3->f("verkoop")<$bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"]) $bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"]=$db3->f("verkoop");
	// 							if($db3->f("verkoop")>$bijkomendekosten[$db2->f("bijkomendekosten_id")]["max"]) $bijkomendekosten[$db2->f("bijkomendekosten_id")]["max"]=$db3->f("verkoop");

	// 							if($_GET["optie_datum"] and $db3->f("week")==$_GET["optie_datum"]) {
	// 								$bijkomendekosten[$db2->f("bijkomendekosten_id")]["exact"]=$db3->f("verkoop");
	// 							}
	// 						}
	// 					}
	// 				}
	// 				if(isset($bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"])) {

	// 					if(!$bijkomendekosten_header_getoond) {

	// 						$bijkomendekosten_header1.="<TABLE width=\"660\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">";
	// 						$bijkomendekosten_header1.="<tr><td><b>".html("bijkomendekosten","toonaccommodatie")."</b>";


	// 						$bijkomendekosten_header2.="<TABLE width=\"660\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"toonacctabel\">";
	// 						$bijkomendekosten_header2.="<TR><TH colspan=\"2\">".html("bijkomendekosten","toonaccommodatie")."";

	// 						$bijkomendekosten_header_getoond=true;
	// 					}

	// 					$bijkomendekosten_table.="<tr><td>";
	// 					$bijkomendekosten_table.="<table class=\"optietabel\" cellspacing=\"0\" border=\"0\" width=\"645\">";
	// 					$bijkomendekosten_table.="<tr>";
	// 					$bijkomendekosten_table.="<td width=\"495\" class=\"nowrap\">".wt_he($db2->f("naam"));
	// 					if($db2->f("omschrijving")) {
	// 						$bijkomendekosten_table.="&nbsp;<a href=\"javascript:popwindow(500,0,'".$vars["path"]."popup.php?id=bijkomendekosten&bkid=".$db2->f("bijkomendekosten_id")."');\">&#187;</a>";
	// 					}
	// 					$bijkomendekosten_table.="</td><td align=\"right\">";
	// 					if($bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"]==$bijkomendekosten[$db2->f("bijkomendekosten_id")]["max"] or $bijkomendekosten[$db2->f("bijkomendekosten_id")]["exact"]<>0) {

	// 						if($bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"]<>$bijkomendekosten[$db2->f("bijkomendekosten_id")]["max"]) {
	// 							$bijkomendekosten_afhankelijkvandatum=true;
	// 						}

	// 						if($bijkomendekosten[$db2->f("bijkomendekosten_id")]["exact"]) {
	// 							$bijkomendekosten_bedrag=$bijkomendekosten[$db2->f("bijkomendekosten_id")]["exact"];
	// 						} else {
	// 							$bijkomendekosten_bedrag=$bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"];
	// 						}

	// 						if($db2->f("perboekingpersoon")==2) {
	// 							$bijkomendekosten_table.=html("perpersoonafk","toonaccommodatie");
	// 						} else {
	// 							$bijkomendekosten_table.="&nbsp;";
	// 						}
	// 						if($bijkomendekosten_bedrag<0) {
	// 							$bijkomendekosten_table.="<td align=\"right\">".html("korting","vars")."</td>";
	// 						} else {
	// 							$bijkomendekosten_table.="<td>&nbsp;</td>";
	// 						}
	// 						$bijkomendekosten_table.="<td align=\"right\">&euro;</td>";
	// 						$bijkomendekosten_table.="<td width=\"60\" align=\"right\">".number_format(abs($bijkomendekosten_bedrag),2,',','.')."</td>";
	// 					} else {
	// 						if($bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"]>0 and $bijkomendekosten[$db2->f("bijkomendekosten_id")]["max"]>0 and $db2->f("min_personen")) {
	// 							//
	// 							// surcharge extra persons with variable prices
	// 							//
	// 							// $bijkomendekosten_table.="<td colspan=\"4\" align=\"right\" class=\"nowrap\">".html("maximaalXeuro","toonaccommodatie", array("v_bedragmin"=>number_format($bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"], 2, ",", "."), "v_bedragmax"=>number_format($bijkomendekosten[$db2->f("bijkomendekosten_id")]["max"], 2, ",", ".")))."<br/>(<a href=\"".wt_he($vars["path"].txt("menu_calc").".php?tid=".$typeid."&back=".urlencode($_SERVER["REQUEST_URI"]."#prijsinformatie"))."\">".html("berekentotaalbedrag", "toonaccommodatie")."</a>)</td>";
	// 							$bijkomendekosten_table.="<td colspan=\"4\" align=\"right\" class=\"nowrap\">".html("maximaalXeuro","toonaccommodatie", array("v_bedragmin"=>number_format($bijkomendekosten[$db2->f("bijkomendekosten_id")]["min"], 2, ",", "."), "v_bedragmax"=>number_format($bijkomendekosten[$db2->f("bijkomendekosten_id")]["max"], 2, ",", "."), "h_1"=>"<a href=\"javascript:popwindow(500,0,'".$vars["path"]."popup.php?tid=".intval($typeid)."&id=bijkomendekosten&bkid=".$db2->f("bijkomendekosten_id")."');\">", "h_2"=>"</a>"))."</td>";
	// 						} else {
	// 							$bijkomendekosten_table.="<td colspan=\"4\" align=\"right\">".html("afhankelijkvandatum","toonaccommodatie")."</td>";
	// 						}
	// 						$bijkomendekosten_afhankelijkvandatum=true;
	// 					}
	// 					$bijkomendekosten_table.="</tr>";
	// 					$bijkomendekosten_table.="</table>";
	// 					$bijkomendekosten_table.="</td></tr>";
	// 				}
	// 			}
	// 			if($bijkomendekosten_header_getoond) {
	// 				$bijkomendekosten_table.="</TABLE>";
	// 			}
	// 		}
	// 	}
	// 	if($bijkomendekosten_table) {
	// 		echo "<p>";
	// 		if($optie_pulldown_teller and $bijkomendekosten_afhankelijkvandatum) {
	// 			echo "<form name=\"bijkomendekostentabel2".$seizoenid."\" method=\"get\" action=\"".$_SERVER["PHP_SELF"]."#prijsinformatie\" style=\"padding:0px;\">";
	// 			echo $bijkomendekosten_header2;
	// 			echo "<input type=\"hidden\" name=\"selecttab\" value=\"tarieven\">\n";

	// 			@reset($_GET);
	// 			while(list($key2,$value2)=@each($_GET)) {
	// 				if($key2<>"optie_datum" and $key2<>"selecttab" and !is_array($value2)) echo "<input type=\"hidden\" name=\"".$key2."\" value=\"".wt_he($value2)."\">\n";
	// 			}
	// 			echo ereg_replace("optietabel".$seizoenid,"bijkomendekostentabel2".$seizoenid,ereg_replace(html("optietarieven","toonaccommodatie")." ","",$optie_pulldown_html));
	// 		} else {
	// 			echo $bijkomendekosten_header2;
	// 		}
	// 		echo "</th></tr>";

	// 		echo $bijkomendekosten_table;
	// 	}
	// }

	if(!$nieuwe_tarieventabel) {
		# Doorgeven aan javascript hoeveel tarieventabellen er zijn
		echo "<form name=\"frm_aantaltarieventabellen\"><input type=\"hidden\" name=\"aantaltarieventabellen\" value=\"".$seizoenteller."\"></form>";
	}

	echo "</div>";

	echo "</div>";

	echo "</div>";

	echo "</div>";


	if(($vars["seizoentype"]==1 or $vars["websitetype"]==7) and $last_acc_html) {
		echo $last_acc_html;
		echo "<div style=\"clear: both;\"></div>\n";
	}

	echo "</div>";

	echo "<div id=\"toonaccommodatie_boekbalk\" class=\"noprint\">";

	echo "<div id=\"toonaccommodatie_boekbalk_bovenkant\">";

	if($vars["seizoentype"]==1 and $vars["websitetype"]<>6) {
		#echo "<div id=\"toonaccommodatie_blauwelijn_rechts\">&nbsp;</div>\n";
	}

	if($_GET["back"]) {
		if(preg_match("@^%2F@", $_GET["back"])) {
			// $_GET["back"] is still urlencoded: decode
			$_GET["back"] = urldecode($_GET["back"]);
		}
		echo "<a href=\"";
		if(preg_match("/^https?/",$_GET["back"])) {
			echo wt_he($_GET["back"]);
		} else {
			if($_SERVER["HTTPS"]=="on") {
				echo "https://".$_SERVER["HTTP_HOST"].wt_he($_GET["back"]);
			} else {
				echo "http://".$_SERVER["HTTP_HOST"].wt_he($_GET["back"]);
			}
		}
		if($_GET["cnt"]) {
			echo "#cnt".$_GET["cnt"];
		}
		echo "\" id=\"terugnaarzoekresultaten\" class=\"button_accpagina noprint\">&laquo; ";
		if(ereg(txt("menu_top10")."\.php",$_GET["back"])) {
			echo html("terugnaartop10","toonaccommodatie");
		} elseif(ereg(txt("menu_aanbiedingen")."\.php",$_GET["back"]) or preg_match("/\/".txt("menu_aanbiedingen")."\//",$_GET["back"])) {
			echo html("terugnaaraanbiedingen","toonaccommodatie");
		} else {
			echo html("terugnaarzoekresultaten","toonaccommodatie");
		}
		echo "</a>";
	}

	echo "<form method=\"get\" name=\"aanvraag\" action=\"".$path.txt("menu_beschikbaarheid").".php\">";
	echo "<input type=\"hidden\" name=\"tid\" value=\"".substr($url[0],1)."\">";
	echo "<input type=\"hidden\" name=\"back\" value=\"".wt_he($_SERVER["REQUEST_URI"])."\">";
	echo "<input type=\"hidden\" name=\"d\" value=\"".($_GET["abd"] ? wt_he($_GET["abd"]) : wt_he($_GET["d"]))."\">";
	echo "<input type=\"hidden\" name=\"ap\" value=\"".wt_he($_GET["ap"])."\">";
	echo "<input type=\"hidden\" name=\"o\" value=\"".wt_he($_GET["o"])."\">";

	if($_GET["fdu"]) {
		echo "<input type=\"hidden\" name=\"fdu\" value=\"".wt_he($_GET["fdu"])."\">";
	}

	if($_GET["flad"] and $_GET["fldu"] and $accinfo["flexibel"]) {
		echo "<input type=\"hidden\" name=\"flad\" value=\"".wt_he($_GET["flad"])."\">";
		echo "<input type=\"hidden\" name=\"fldu\" value=\"".wt_he($_GET["fldu"])."\">";
	}

	# Button "Accommodatie boeken"
	if($echt_tarieven_getoond) {
		echo "<div class=\"button_accpagina boekbutton".($ga_verder ? " boekbutton_ga_verder" : "")."\" onclick=\"document.aanvraag.action='".$path.txt("menu_boeken").".php';document.aanvraag.submit();\">";
		if(ereg("^[0-9]+$",$_COOKIE["CHALET"]["boeking"]["boekingid"])) {
			$db2->query("SELECT type_id FROM boeking WHERE boeking_id='".addslashes($_COOKIE["CHALET"]["boeking"]["boekingid"])."' AND bevestigdatum IS NULL;");
			if($db2->next_record()) {
				if($typeid==$db2->f("type_id")) $ga_verder=true;
			}
		}
		if($ga_verder) {
			echo html("gaverdermetboeken","toonaccommodatie")." &gt; &gt;";
		} else {
#			echo html("accommodatieboeken","toonaccommodatie");
			echo "<div class=\"boekbutton_tekst\">".html("boeknu","toonaccommodatie")."</div>";
		}
		echo "</div>";

		# Button "Beschikbaarheid controleren"
#		echo "<div class=\"button_accpagina\" onclick=\"document.aanvraag.o.value=0;document.aanvraag.action='".$vars["path"].txt("menu_beschikbaarheid").".php';document.aanvraag.submit();\">";
#		echo html("beschikbaarheidcontroleren","toonaccommodatie");
#		echo "</div>";

		# Button "Optie aanvragen"
		echo "<div class=\"button_accpagina\" onclick=\"document.aanvraag.o.value=1;document.aanvraag.action='".$vars["path"].txt("menu_beschikbaarheid").".php';document.aanvraag.submit();\">";
		echo html("optieaanvragen","toonaccommodatie",array("h_1"=>"<b>","h_2"=>"</b>"));
		echo "</div>";

		# Button "Prijs berekenen"
		echo "<div class=\"button_accpagina\" onclick=\"document.aanvraag.o.value=1;document.aanvraag.action='".$vars["path"].txt("menu_calc").".php';document.aanvraag.submit();\">";
		echo html("prijsberekenen","toonaccommodatie",array("h_1"=>"<b>","h_2"=>"</b>"));
		echo "</div>";
	}

	if($vars["websitetype"]<>6) { # geen favorieten bij Chaletsinvallandry

		#
		# Favorietenbuttons
		#
		$db0->query("SELECT type_id FROM bezoeker_favoriet WHERE bezoeker_id='".addslashes($_COOKIE["sch"])."' AND type_id='".addslashes($typeid)."';");
		if($db0->num_rows()) {
			$favorieten_plaatsbutton=false;
		} else {
			$favorieten_plaatsbutton=true;
		}

		echo "<div id=\"favadd\" class=\"button_accpagina\" style=\"".($favorieten_plaatsbutton ? "" : "display:none;")."\" onclick=\"return favorieten_opslaan_verwijderen('".$db->f("begincode")."','".$typeid."','insert');\">";
		echo html("plaatsinfavorieten","toonaccommodatie",array("h_1"=>"<b>","h_2"=>"</b>"));
		echo "</div>";

		echo "<div id=\"favremove\" class=\"button_accpagina\" style=\"".($favorieten_plaatsbutton ? "display:none;" : "")."\" onclick=\"return favorieten_opslaan_verwijderen('".$db->f("begincode")."','".$typeid."','delete');\">";
		echo html("uitmijnfavorietenhalen","toonaccommodatie",array("h_1"=>"<b>","h_2"=>"</b>"));
		echo "</div>";
	}

	echo "</form>";

	echo "<div id=\"toonaccommodatie_kleinelinks\">";

	#
	# Blok met social media-buttons + print/mail-buttons
	#
	echo "<div id=\"socialmedia\" class=\"socialshare\">";


	# Printbutton
	echo "<a href=\"#\" class=\"print\" onclick=\"window.print();return false;\" title=\"".html("paginaafdrukken","toonaccommodatie")."\"></a>";

	# Doormailfunctie
	echo "<a href=\"#\" class=\"mail\" onclick=\"popwindow(800,740,'".$vars["path"]."popup.php?id=accommodatiemail&accid=".$typeid."');return false;\" title=\"".html("popuptitle_stuurdoor")."\"></a>";

	# Social media-links
	if($vars["website"]=="C" or $vars["website"]=="Z" or $vars["website"]=="I" or $vars["website"]=="W") {

		$share_url=$vars["canonical"];
		$share_text="Bekijk deze accommodatie bij ".$vars["websitenaam"];
		echo "<a href=\"".wt_he("https://www.facebook.com/sharer.php?u=".urlencode($share_url)."&t=".urlencode($share_text))."\" title=\"Deel deze accommodatie met je Facebook-vrienden\" class=\"facebook_share_window fb\"></a>";
		echo "<a href=\"".wt_he("https://twitter.com/home?status=".urlencode($share_text.": ".$share_url))."\" title=\"Deel deze accommodatie met je Twitter-volgers\" class=\"twitter_share_window tw\"></a>";
		echo "<a href=\"".wt_he("https://plus.google.com/share?url=".urlencode($share_url))."\" title=\"Deel deze accommodatie met je Google+-circles\" class=\"googleplus_share_window gplus\"></a>";
	}
	echo "<div style=\"clear:both;\"></div>";

	echo "</div>"; # afsluiten #socialmedia


	echo "<ul class=\"list_under_bookbuttons\">";

	# "Word bestand downloaden"-link voor ingelogde reisagenten
	if($vars["wederverkoop"] and ($vars["chalettour_logged_in"] or $voorkant_cms)) {
		echo "<li><a href=\"".$vars["path"]."accommodatie_word.php?accid=".wt_he($typeid)."\" rel=\"nofollow\">".html("wordbestanddownloaden","toonaccommodatie")."</a></li>";
	}

	if($voorkant_cms) {
		echo "<li><a href=\"" . $vars["cmspath"];
		echo "cms_accommodaties.php?wzt=".$db->f("wzt")."&show=1&1k0=".$accinfo["accommodatie_id"]."\" target=\"_blank\">Accommodatie bewerken</a></li>";
		echo "<li><a href=\"" . $vars["cmspath"];
		echo "cms_types.php?wzt=".$db->f("wzt")."&show=2&2k0=".$typeid."\" target=\"_blank\">Type bewerken</a></li>";
		echo "<li><a href=\"".wt_he($_SERVER["REQUEST_URI"]).(ereg("\?",$_SERVER["REQUEST_URI"]) ? "&cmsuit=1" : "?cmsuit=1")."\">Zonder interne informatie</a></li>";
	}

	echo "</ul>";

	echo "</div>";


	echo "</div>"; # afsluiten #toonaccommodatie_boekbalk_bovenkant


	#
	# Andere types van dezelfde accommodaties
	#
# 1=>txt("chalet","vars"),
# 2=>txt("appartement","vars"),
# 3=>txt("hotel","vars"),
# 4=>txt("chaletappartement","vars"),
# 6=>txt("vakantiewoning","vars"),
# 7=>txt("villa","vars"),
# 8=>txt("kasteel","vars"));

	$gekoppeld=gekoppelde_acc($accinfo["accommodatie_id"]);
	reset($gekoppeld);
	while(list($key,$value)=each($gekoppeld)) {
		if($gekoppeld_inquery) $gekoppeld_inquery.=",".$key; else $gekoppeld_inquery=$key;
	}

	$gekoppeld_order="FIND_IN_SET(a.soortaccommodatie,'3,8,2,4,6,7,1'), ";
	if($_GET["d"]) {

		if($_GET["ap"] and !$vars["wederverkoop"] and $accinfo["toonper"]==1) {
			// tarieven arrangementen ophalen
			$db2->query("SELECT DISTINCT t.type_id, tp.prijs AS prijs_per_persoon FROM accommodatie a, type t, tarief_personen tp WHERE tp.week='".addslashes($_GET["d"])."' AND tp.personen='".intval($_GET["ap"])."' AND tp.type_id=t.type_id AND a.accommodatie_id=t.accommodatie_id AND a.tonen=1 AND t.tonen=1 AND a.accommodatie_id IN(".addslashes($gekoppeld_inquery).");");

			// echo $db2->lq;
			while($db2->next_record()) {
				$alletypes_prijs[$db2->f("type_id")]=$db2->f("prijs_per_persoon");
			}
		}
		$db2->query("SELECT DISTINCT a.accommodatie_id, a.soortaccommodatie, t.type_id, t.badkamers, t.slaapkamers, p.naam".$vars["ttv"]." AS plaats, l.naam".$vars["ttv"]." AS land, l.begincode, s.naam".$vars["ttv"]." AS skigebied, a.toonper, a.naam, t.naam".$vars["ttv"]." AS type, t.optimaalaantalpersonen, t.maxaantalpersonen, ta.seizoen_id, ta.beschikbaar, ta.bruto, ta.c_bruto, ta.c_verkoop_site, ta.wederverkoop_verkoopprijs FROM accommodatie a, type t, plaats p, skigebied s, land l, tarief ta WHERE ta.week='".addslashes($_GET["d"])."' AND ta.type_id=t.type_id AND a.accommodatie_id=t.accommodatie_id AND a.tonen=1 AND t.websites LIKE '%".$vars["website"]."%' AND t.tonen=1 AND p.land_id=l.land_id AND p.skigebied_id=s.skigebied_id AND a.plaats_id=p.plaats_id AND a.accommodatie_id IN(".addslashes($gekoppeld_inquery).") ORDER BY ".$gekoppeld_order."t.optimaalaantalpersonen, t.maxaantalpersonen, a.naam, t.naam".$vars["ttv"].";");
	} else {
		$db2->query("SELECT DISTINCT a.accommodatie_id, a.soortaccommodatie, t.type_id, t.badkamers, t.slaapkamers, p.naam".$vars["ttv"]." AS plaats, l.naam".$vars["ttv"]." AS land, l.begincode, s.naam".$vars["ttv"]." AS skigebied, a.toonper, a.naam, t.naam".$vars["ttv"]." AS type, t.optimaalaantalpersonen, t.maxaantalpersonen FROM accommodatie a, type t, plaats p, skigebied s, land l WHERE a.accommodatie_id=t.accommodatie_id AND a.tonen=1 AND t.websites LIKE '%".$vars["website"]."%' AND t.tonen=1 AND p.land_id=l.land_id AND p.skigebied_id=s.skigebied_id AND a.plaats_id=p.plaats_id AND a.accommodatie_id IN(".addslashes($gekoppeld_inquery).") ORDER BY ".$gekoppeld_order."t.optimaalaantalpersonen, t.maxaantalpersonen, a.naam, t.naam".$vars["ttv"].";");
	}
	if($db2->num_rows()) {
		while($db2->next_record()) {
			if($db2->f("type_id")<>$typeid) {
				$alletypestonen=true;
			}
			$gekoppeld_soortaccommodatie[$db2->f("soortaccommodatie")]++;
		}
		$db2->seek();
	}

	// wel/geen prijzen tonen
	if($_GET["d"] and ($_GET["ap"] or $vars["wederverkoop"] or $accinfo["toonper"]==3)) {
		$alletypes_toon_prijzen=true;
	}

	// alle types van deze accommodatie
	if($alletypestonen) {
		echo "<div id=\"toonaccommodatie_boekbalk_alletypes\">";
		echo "<div class=\"alletypes_header\">";
		echo html("alletypes2","toonaccommodatie");
		echo "</div>";

		$bijkomendekosten = new bijkomendekosten;
		$bijkomendekosten->setRedis(new wt_redis);
		$bk = $bijkomendekosten->get_complete_cache($vars["seizoentype"]);


		while($db2->next_record()) {

			// prijs berekenen
			unset($prijs, $bk_add_to_price);
			$alletypes_beschikbaar_class="";
			if($_GET["d"]) {
				if($db2->f("beschikbaar") and ($db2->f("bruto")>0 or $db2->f("c_bruto")>0)) {
					$alletypes_beschikbaar_class="alletypes_beschikbaar";
					if($vars["wederverkoop"]) {
						$prijs=$db2->f("wederverkoop_verkoopprijs");
					} elseif($accinfo["toonper"]==1) {
						$prijs=$alletypes_prijs[$db2->f("type_id")];
					} else {
						$prijs=$db2->f("c_verkoop_site");
					}
					if($prijs) {
						// bijkomende kosten other types
						if($db2->f("toonper")==1) {
							// arrangement
							$temp_aantalpersonen = ($_GET["ap"] ? $_GET["ap"] : $db2->f("maxaantalpersonen"));
							$bk_add_to_price = $bk[$db2->f("type_id")][$db2->f("seizoen_id")][$temp_aantalpersonen] / $temp_aantalpersonen;
						} else {
							// losse accommodatie
							$temp_aantalpersonen = ($_GET["ap"] ? $_GET["ap"] : 1);
							$bk_add_to_price = $bk[$db2->f("type_id")][$db2->f("seizoen_id")][$temp_aantalpersonen];

							// surcharge extra persons (toeslag extra personen)
							$bk_add_to_price_per_person_per_week = $bijkomendekosten->get_type_from_cache_all_persons_all_weeks($db2->f("type_id"), $vars["seizoentype"]);
							if( isset( $bk_add_to_price_per_person_per_week[$temp_aantalpersonen][$_GET["d"]] ) ) {
								$bk_add_to_price += $bk_add_to_price_per_person_per_week[$temp_aantalpersonen][$_GET["d"]];
							}
						}

						if($bk_add_to_price>0) {
							$prijs = $prijs + $bk_add_to_price;
							$prijs = ceil($prijs);
						} else {
							unset($prijs);
							// trigger_error("prijs zonder bijkomende kosten (alle types van deze accommodatie)",E_USER_NOTICE);
						}
					}
				} else {
					$alletypes_beschikbaar_class="alletypes_niet_beschikbaar";
					$nietbeschikbaar_getoond=true;
				}
			}


			if($alletypes_toon_prijzen and $db2->f("beschikbaar") and !$prijs) {
				// continue;
			}

			$anderetypes.="<div class=\"alletypes_item\">";
			if(@count($gekoppeld_soortaccommodatie)>=2) {
				$vars["soortaccommodatie_meervoud"]=array(1=>txt("chalets","vars"),2=>txt("appartementen","vars"),3=>txt("hotels","vars"),4=>txt("chaletappartementen","vars"),6=>txt("vakantiewoningen","vars"),7=>txt("villas","vars"),8=>txt("kastelen","vars"));
				unset($gekoppeld_toon);
				if(!$gekoppeld_soortaccommodatie_gehad[$db2->f("soortaccommodatie")]) {
					$gekoppeld_toon=$vars["soortaccommodatie_meervoud"][$db2->f("soortaccommodatie")];
					$gekoppeld_soortaccommodatie_gehad[$db2->f("soortaccommodatie")]=true;
				}
				if($gekoppeld_toon) {
					$anderetypes.="<div class=\"alletypes_soort_accommodatie\">".wt_he(ucfirst($gekoppeld_toon))."</div>";
				}
			}

			if($accinfo["type_id"]==$db2->f("type_id")) {
				$anderetypes.="<div class=\"".trim("alletypes_type ".$alletypes_beschikbaar_class)."\">";
			} else {
				$linkandertype=$vars["path"].txt("menu_accommodatie")."/".$db2->f("begincode").$db2->f("type_id")."/".($_SERVER["QUERY_STRING"] ? "?".$_SERVER["QUERY_STRING"] : "")."#indeling";
				$anderetypes.="<a href=\"".wt_he($linkandertype)."\" class=\"alletypes_type ".trim("linkandertype ".$alletypes_beschikbaar_class)."\">";
			}


			// aantal personen
			$anderetypes.="<div class=\"alletypes_aantalpersonen\">";
			$anderetypes.=$db2->f("optimaalaantalpersonen").($db2->f("maxaantalpersonen")>$db2->f("optimaalaantalpersonen") ? " - ".$db2->f("maxaantalpersonen") : "")." ";
			if($db2->f("maxaantalpersonen")==1) {
				$anderetypes.=html("persoon");
			} else {
				$anderetypes.=html("personen");
			}
			$anderetypes.="</div>"; // afsluiten .alletypes_aantalpersonen

			// typenaam
			$anderetypes.="<div class=\"alletypes_typenaam\">";
			if($db2->f("type")) {
				$typenaam=ereg_replace("^\((.*)\)","\\1",$db2->f("type"));
				$anderetypes.=wt_he($typenaam);
			}
			$anderetypes.="</div>"; // afsluiten .alletypes_typenaam

			// prijs
			if($alletypes_toon_prijzen) {
				$anderetypes.="<div class=\"alletypes_prijs\">";
				if($prijs>0) {
					$anderetypes.="&euro;&nbsp;".number_format($prijs, 0, ",", ".")." <span>";
					$alletypes_prijs_getoond=true;
					if($accinfo["toonper"]==1 and !$vars["wederverkoop"]) {
						$anderetypes.=html("perpersoonafk","toonaccommodatie");
					}
					$anderetypes.="</span>";
				} elseif($db2->f("beschikbaar")) {
					// wel beschikbaar, geen prijs bekend (zou eigenlijk niet mogen voorkomen)
					$anderetypes.="&nbsp;";
				} else {
					$anderetypes.="&nbsp;<span class=\"nietbeschikbaar\">".html("nietbeschikbaar","toonaccommodatie")."</span>";
				}
				$anderetypes.="</div>"; // afsluiten .alletypes_prijs
			}

			$anderetypes.="<div class=\"clear\"></div>";

			if($accinfo["type_id"]==$db2->f("type_id")) {
				$anderetypes.="</div>";
			} else {
				$anderetypes.="</a>";
			}
			// $anderetypes.="</div><div style=\"clear:both;\"></div>";

			$anderetypes.="</div>"; // afsluiten .alletypes_item
		}
		if($_GET["d"]) {
			echo "<div class=\"alletypes_legenda\">";
			echo "<h2>".datum("D MAAND JJJJ",$_GET["d"],$vars["taal"])."</h2>";
			if($alletypes_prijs_getoond) {
				echo "<div>";
				echo "<span class=\"prijs\">".html("prijs","toonaccommodatie")."</span> = ";
				if($accinfo["toonper"]==1 and !$vars["wederverkoop"]) {
					echo html("perpersooninclskipas","toonaccommodatie");
				} else {
					echo html("peraccommodatie","toonaccommodatie");
				}
				echo "</div>";
			}
			echo "<div class=\"clear\"></div>";
			echo "</div>";
		}

		echo $anderetypes;

		echo "</div>";
	}

	echo "</div>";

	echo "<div style=\"clear: both;\"></div>\n";
} else {
	# Accommodatie niet gevonden of staat op "niet tonen"
	echo "<div style=\"margin-left:200px;margin-top:15px;\">";
	echo "<b>".html("accommodatienietgevonden","toonaccommodatie")."</b><p>";
	echo html("accommodatienietgevonden_lang","toonaccommodatie",array("v_websitenaam"=>$vars["websitenaam"],"l1"=>"accommodaties"));
	echo "</p></div>";
}

# Accommodatie-gegevens
function toon_tekst_acc_en_type($tekst1, $tekst2="", $connector="<br/><br/>") {

	$tekst1=trim($tekst1);
	$tekst2=trim($tekst2);

	if($tekst1 and $tekst2) {
		return nl2br(wt_htmlent($tekst1)).$connector.nl2br(wt_htmlent($tekst2));
	} elseif($tekst1) {
		return nl2br(wt_htmlent($tekst1));
	} else {
		return nl2br(wt_htmlent($tekst2));
	}
}

if(!defined("wt_test") and !$voorkant_cms) {
	$product_details_impressions['list'] = (ereg(txt("menu_aanbiedingen")."\.php",$_GET["back"]) or preg_match("/\/".txt("menu_aanbiedingen")."\//",$_GET["back"])) ? html("aanbiedingen","aanbiedingen") : html("zoekenboek","index");
	$ie = (preg_match("@MSIE 8@",$_SERVER["HTTP_USER_AGENT"]) && preg_match("@accommodatie@",$_SERVER['SCRIPT_FILENAME']) === 1) ? true : false;
	$google_tagmanager = new google_tagmanager;
	echo $google_tagmanager->product_detail_impressions($product_details_impressions, $ie);
}

// Criteo retargeting datalayer tags
if($vars["website"]=="C") {
	$criteo = new CriteoTags;
	echo $criteo->productPage($typeid);
}

if(is_object($opmaak)) {
	// tarieventabel_totaalprijs_specificatie_popup (hide by default)
	$opmaak->html_at_the_bottom("<div class=\"tarieventabel_totaalprijs_specificatie_popup tarieventabel_totaalprijs_specificatie_empty\"><img src=\"".$vars["path"]."pic/close_icon.png\" class=\"close\" /><div></div></div>");
}
